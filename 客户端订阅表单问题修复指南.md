# å®¢æˆ·ç«¯è®¢é˜…è¡¨å•é—®é¢˜ä¿®å¤æŒ‡å—

## é—®é¢˜æè¿°
å®¢æˆ·ç«¯ç½‘ç«™çš„è®¢é˜…è¡¨å•æäº¤å¤±è´¥ï¼Œæ§åˆ¶å°æ˜¾ç¤ºï¼š
```
[ERROR] âŒ è®¢é˜…ç³»ç»Ÿè¿æ¥å¤±è´¥: {}
[ERROR] è¡¨å•æäº¤å¤±è´¥: {}
```

---

## ğŸ” é—®é¢˜è¯Šæ–­

### å¯èƒ½çš„åŸå› 

1. **åç«¯æœåŠ¡å™¨æœªå¯åŠ¨** âš ï¸
   - APIåœ°å€: `http://localhost:3000/api`
   - éœ€è¦å…ˆå¯åŠ¨åç«¯æœåŠ¡

2. **CORSè·¨åŸŸé—®é¢˜** âš ï¸
   - ä½¿ç”¨file://åè®®æ‰“å¼€HTMLæ–‡ä»¶
   - æµè§ˆå™¨é˜»æ­¢è·¨åŸŸè¯·æ±‚

3. **ç½‘ç»œè¿æ¥é—®é¢˜** âš ï¸
   - é˜²ç«å¢™é˜»æ­¢
   - ç«¯å£è¢«å ç”¨

---

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: å¯åŠ¨åç«¯æœåŠ¡ï¼ˆå¿…é¡»ï¼‰

#### æ­¥éª¤1: æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ

```bash
# æ–¹æ³•1: è®¿é—®å¥åº·æ£€æŸ¥æ¥å£
curl http://localhost:3000/api/health

# æ–¹æ³•2: æ£€æŸ¥ç«¯å£å ç”¨
netstat -ano | findstr :3000
```

#### æ­¥éª¤2: å¯åŠ¨åç«¯æœåŠ¡

```bash
cd backend
npm run dev
```

**é¢„æœŸè¾“å‡º**:
```
Server is running on port 3000
Database connected successfully
```

#### æ­¥éª¤3: éªŒè¯APIå¯è®¿é—®

```bash
# æµ‹è¯•è®¢é˜…API
curl -X POST http://localhost:3000/api/subscriptions \
  -H "Content-Type: application/json" \
  -d "{\"contactType\":\"email\",\"contactValue\":\"test@example.com\",\"source\":\"website_footer\"}"
```

**é¢„æœŸå“åº”**:
```json
{
  "code": 200,
  "msg": "è®¢é˜…æˆåŠŸ",
  "data": {...}
}
```

---

### æ–¹æ¡ˆ2: ä½¿ç”¨æœ¬åœ°WebæœåŠ¡å™¨ï¼ˆæ¨èï¼‰

**é—®é¢˜**: ç›´æ¥åŒå‡»æ‰“å¼€HTMLæ–‡ä»¶ä½¿ç”¨çš„æ˜¯`file://`åè®®ï¼Œä¼šå¯¼è‡´CORSé—®é¢˜

**è§£å†³**: ä½¿ç”¨æœ¬åœ°WebæœåŠ¡å™¨

#### é€‰é¡¹A: ä½¿ç”¨Live Server (VS Codeæ’ä»¶)

1. å®‰è£…VS Codeæ’ä»¶ "Live Server"
2. å³é”®ç‚¹å‡» `index.html`
3. é€‰æ‹© "Open with Live Server"
4. æµè§ˆå™¨è‡ªåŠ¨æ‰“å¼€ `http://127.0.0.1:5500`

#### é€‰é¡¹B: ä½¿ç”¨Python HTTPæœåŠ¡å™¨

```bash
# è¿›å…¥ç½‘ç«™ç›®å½•
cd "web Site/web PC"

# Python 3
python -m http.server 8080

# è®¿é—®
# http://localhost:8080
```

#### é€‰é¡¹C: ä½¿ç”¨Node.js http-server

```bash
# å…¨å±€å®‰è£…
npm install -g http-server

# è¿›å…¥ç½‘ç«™ç›®å½•
cd "web Site/web PC"

# å¯åŠ¨æœåŠ¡å™¨
http-server -p 8080

# è®¿é—®
# http://localhost:8080
```

---

### æ–¹æ¡ˆ3: ä¿®æ”¹APIé…ç½®ï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰

å¦‚æœåç«¯è¿è¡Œåœ¨ä¸åŒçš„ç«¯å£æˆ–åœ°å€ï¼Œéœ€è¦ä¿®æ”¹APIé…ç½®ï¼š

**æ–‡ä»¶**: `web Site/web PC/assets/js/api.js`

```javascript
// ä¿®æ”¹è¿™ä¸€è¡Œ
const API_CONFIG = {
    baseURL: 'http://localhost:3000/api',  // æ”¹ä¸ºå®é™…çš„åç«¯åœ°å€
    timeout: 10000
};
```

**å¯èƒ½çš„é…ç½®**:
- æœ¬åœ°å¼€å‘: `http://localhost:3000/api`
- å±€åŸŸç½‘: `http://192.168.1.100:3000/api`
- ç”Ÿäº§ç¯å¢ƒ: `https://api.yourdomain.com/api`

---

## ğŸ§ª å®Œæ•´æµ‹è¯•æµç¨‹

### æ­¥éª¤1: å¯åŠ¨åç«¯æœåŠ¡

```bash
# ç»ˆç«¯1
cd backend
npm run dev
```

**éªŒè¯**: çœ‹åˆ° "Server is running on port 3000"

### æ­¥éª¤2: å¯åŠ¨å®¢æˆ·ç«¯WebæœåŠ¡å™¨

```bash
# ç»ˆç«¯2
cd "web Site/web PC"
python -m http.server 8080
```

**éªŒè¯**: çœ‹åˆ° "Serving HTTP on 0.0.0.0 port 8080"

### æ­¥éª¤3: æ‰“å¼€æµè§ˆå™¨

è®¿é—®: `http://localhost:8080`

### æ­¥éª¤4: æµ‹è¯•è®¢é˜…è¡¨å•

1. æ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨
2. æ‰¾åˆ°è®¢é˜…è¡¨å•
3. è¾“å…¥é‚®ç®±: `test@example.com`
4. ç‚¹å‡»"è®¢é˜…"æŒ‰é’®

**é¢„æœŸç»“æœ**:
- âœ… æ˜¾ç¤º"è®¢é˜…æˆåŠŸ"æç¤º
- âœ… è¡¨å•è‡ªåŠ¨é‡ç½®
- âœ… åç«¯æ§åˆ¶å°æ˜¾ç¤ºæ—¥å¿—

### æ­¥éª¤5: éªŒè¯åå°ç®¡ç†ç³»ç»Ÿ

```bash
# ç»ˆç«¯3
cd admin
npm run dev
```

è®¿é—®: `http://localhost:3007/subscription/list`

**éªŒè¯**:
- âœ… åˆ—è¡¨ä¸­æ˜¾ç¤ºæ–°è®¢é˜…
- âœ… ç»Ÿè®¡æ•°å­—æ›´æ–°
- âœ… 30ç§’å†…è‡ªåŠ¨åˆ·æ–°

---

## ğŸ”§ è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°

**æ‰“å¼€æ–¹å¼**: F12 æˆ– å³é”® -> æ£€æŸ¥

**æ£€æŸ¥é¡¹**:
- Consoleæ ‡ç­¾: æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
- Networkæ ‡ç­¾: æŸ¥çœ‹APIè¯·æ±‚
- çº¢è‰²é”™è¯¯: CORSæˆ–ç½‘ç»œé—®é¢˜
- é»„è‰²è­¦å‘Š: å¯å¿½ç•¥

### 2. æ£€æŸ¥Networkè¯·æ±‚

1. æ‰“å¼€å¼€å‘è€…å·¥å…·
2. åˆ‡æ¢åˆ°Networkæ ‡ç­¾
3. æäº¤è®¢é˜…è¡¨å•
4. æŸ¥çœ‹è¯·æ±‚è¯¦æƒ…

**æ­£å¸¸è¯·æ±‚**:
```
Request URL: http://localhost:3000/api/subscriptions
Request Method: POST
Status Code: 201 Created
```

**å¤±è´¥è¯·æ±‚**:
```
Status: (failed) net::ERR_CONNECTION_REFUSED
æˆ–
Status: (failed) net::ERR_CORS
```

### 3. æŸ¥çœ‹åç«¯æ—¥å¿—

åç«¯æ§åˆ¶å°åº”è¯¥æ˜¾ç¤º:
```
POST /api/subscriptions 201 45ms
è®¢é˜…åˆ›å»ºæˆåŠŸ { subscriptionId: 123, ... }
```

---

## ğŸš¨ å¸¸è§é”™è¯¯åŠè§£å†³

### é”™è¯¯1: ERR_CONNECTION_REFUSED

**åŸå› **: åç«¯æœåŠ¡å™¨æœªå¯åŠ¨

**è§£å†³**:
```bash
cd backend
npm run dev
```

### é”™è¯¯2: CORS Error

**åŸå› **: ä½¿ç”¨file://åè®®æˆ–CORSé…ç½®é—®é¢˜

**è§£å†³**:
1. ä½¿ç”¨æœ¬åœ°WebæœåŠ¡å™¨ï¼ˆæ¨èï¼‰
2. æˆ–ä¿®æ”¹åç«¯CORSé…ç½®

### é”™è¯¯3: 404 Not Found

**åŸå› **: APIè·¯å¾„é”™è¯¯

**æ£€æŸ¥**:
- åç«¯è·¯ç”±: `backend/src/routes/subscriptions.js`
- å‰ç«¯API: `web Site/web PC/assets/js/api.js`

**éªŒè¯è·¯ç”±**:
```bash
# æŸ¥çœ‹æ‰€æœ‰è·¯ç”±
curl http://localhost:3000/api
```

### é”™è¯¯4: 500 Internal Server Error

**åŸå› **: åç«¯ä»£ç é”™è¯¯æˆ–æ•°æ®åº“é—®é¢˜

**è§£å†³**:
1. æŸ¥çœ‹åç«¯æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥æ•°æ®åº“è¿æ¥
3. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶

### é”™è¯¯5: è¯·æ±‚è¶…æ—¶

**åŸå› **: ç½‘ç»œæ…¢æˆ–åç«¯å“åº”æ…¢

**è§£å†³**:
```javascript
// å¢åŠ è¶…æ—¶æ—¶é—´
const API_CONFIG = {
    baseURL: 'http://localhost:3000/api',
    timeout: 30000  // æ”¹ä¸º30ç§’
};
```

---

## ğŸ“‹ æ£€æŸ¥æ¸…å•

åœ¨æäº¤è®¢é˜…å‰ï¼Œç¡®ä¿ï¼š

- [ ] åç«¯æœåŠ¡å™¨å·²å¯åŠ¨ (ç«¯å£3000)
- [ ] ä½¿ç”¨HTTPæœåŠ¡å™¨æ‰“å¼€å®¢æˆ·ç«¯ç½‘ç«™ï¼ˆä¸æ˜¯file://ï¼‰
- [ ] æµè§ˆå™¨æ§åˆ¶å°æ— CORSé”™è¯¯
- [ ] å¯ä»¥è®¿é—® `http://localhost:3000/api/health`
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] ç½‘ç»œè¿æ¥æ­£å¸¸

---

## ğŸ¯ å¿«é€Ÿå¯åŠ¨è„šæœ¬

### Windows (PowerShell)

åˆ›å»ºæ–‡ä»¶ `start-all.ps1`:

```powershell
# å¯åŠ¨åç«¯
Start-Process powershell -ArgumentList "-NoExit", "-Command", "cd backend; npm run dev"

# ç­‰å¾…2ç§’
Start-Sleep -Seconds 2

# å¯åŠ¨ç®¡ç†åå°
Start-Process powershell -ArgumentList "-NoExit", "-Command", "cd admin; npm run dev"

# å¯åŠ¨å®¢æˆ·ç«¯WebæœåŠ¡å™¨
Start-Process powershell -ArgumentList "-NoExit", "-Command", "cd 'web Site/web PC'; python -m http.server 8080"

# æ‰“å¼€æµè§ˆå™¨
Start-Sleep -Seconds 3
Start-Process "http://localhost:8080"
Start-Process "http://localhost:3007/subscription/list"
```

**ä½¿ç”¨**:
```powershell
.\start-all.ps1
```

### Linux/Mac (Bash)

åˆ›å»ºæ–‡ä»¶ `start-all.sh`:

```bash
#!/bin/bash

# å¯åŠ¨åç«¯
cd backend && npm run dev &

# ç­‰å¾…2ç§’
sleep 2

# å¯åŠ¨ç®¡ç†åå°
cd ../admin && npm run dev &

# å¯åŠ¨å®¢æˆ·ç«¯WebæœåŠ¡å™¨
cd "../web Site/web PC" && python3 -m http.server 8080 &

# ç­‰å¾…3ç§’
sleep 3

# æ‰“å¼€æµè§ˆå™¨
open "http://localhost:8080"
open "http://localhost:3007/subscription/list"
```

**ä½¿ç”¨**:
```bash
chmod +x start-all.sh
./start-all.sh
```

---

## ğŸ“Š æµ‹è¯•æ•°æ®

### æœ‰æ•ˆçš„æµ‹è¯•æ•°æ®

**é‚®ç®±**:
- test@example.com
- user@test.com
- admin@company.com

**å¾®ä¿¡å·**:
- wechat123
- wx_user_001
- myWechat

**æ‰‹æœºå·**:
- 13800138000
- 13900139000
- 15800158000

### æ— æ•ˆçš„æµ‹è¯•æ•°æ®ï¼ˆåº”è¯¥è¢«æ‹’ç»ï¼‰

**é‚®ç®±**:
- invalid-email
- test@
- @example.com

**å¾®ä¿¡å·**:
- 123 (å¤ªçŸ­)
- a (å¤ªçŸ­)

**æ‰‹æœºå·**:
- 12345678901 (ä¸æ˜¯1å¼€å¤´)
- 1380013800 (ä½æ•°ä¸å¯¹)

---

## ğŸ” APIæµ‹è¯•å‘½ä»¤

### æµ‹è¯•è®¢é˜…åˆ›å»º

```bash
# é‚®ç®±è®¢é˜…
curl -X POST http://localhost:3000/api/subscriptions \
  -H "Content-Type: application/json" \
  -d '{"contactType":"email","contactValue":"test@example.com","source":"website_footer"}'

# å¾®ä¿¡è®¢é˜…
curl -X POST http://localhost:3000/api/subscriptions \
  -H "Content-Type: application/json" \
  -d '{"contactType":"wechat","contactValue":"wechat123","source":"website_footer"}'

# æ‰‹æœºè®¢é˜…
curl -X POST http://localhost:3000/api/subscriptions \
  -H "Content-Type: application/json" \
  -d '{"contactType":"phone","contactValue":"13800138000","source":"website_footer"}'
```

### æµ‹è¯•é‡å¤è®¢é˜…

```bash
# ç¬¬ä¸€æ¬¡åº”è¯¥æˆåŠŸ
curl -X POST http://localhost:3000/api/subscriptions \
  -H "Content-Type: application/json" \
  -d '{"contactType":"email","contactValue":"duplicate@test.com","source":"website_footer"}'

# ç¬¬äºŒæ¬¡åº”è¯¥è¿”å›409é”™è¯¯
curl -X POST http://localhost:3000/api/subscriptions \
  -H "Content-Type: application/json" \
  -d '{"contactType":"email","contactValue":"duplicate@test.com","source":"website_footer"}'
```

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯æˆªå›¾**
2. **åç«¯æ§åˆ¶å°æ—¥å¿—**
3. **Networkæ ‡ç­¾çš„è¯·æ±‚è¯¦æƒ…**
4. **æ“ä½œç³»ç»Ÿå’Œæµè§ˆå™¨ç‰ˆæœ¬**
5. **åç«¯æœåŠ¡å™¨å¯åŠ¨æ—¥å¿—**

---

## âœ… æˆåŠŸæ ‡å¿—

å½“ä¸€åˆ‡æ­£å¸¸æ—¶ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ï¼š

1. **å®¢æˆ·ç«¯**:
   - âœ… æäº¤åæ˜¾ç¤º"è®¢é˜…æˆåŠŸ"
   - âœ… è¡¨å•è‡ªåŠ¨æ¸…ç©º
   - âœ… æ— æ§åˆ¶å°é”™è¯¯

2. **åç«¯**:
   - âœ… æ§åˆ¶å°æ˜¾ç¤º"è®¢é˜…åˆ›å»ºæˆåŠŸ"
   - âœ… è¿”å›201çŠ¶æ€ç 
   - âœ… æ•°æ®ä¿å­˜åˆ°æ•°æ®åº“

3. **ç®¡ç†åå°**:
   - âœ… 30ç§’å†…è‡ªåŠ¨åˆ·æ–°
   - âœ… æ˜¾ç¤ºæ–°è®¢é˜…è®°å½•
   - âœ… å¼¹å‡ºé€šçŸ¥æé†’

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-11-19 20:15  
**çŠ¶æ€**: é—®é¢˜è¯Šæ–­å’Œè§£å†³æ–¹æ¡ˆ
