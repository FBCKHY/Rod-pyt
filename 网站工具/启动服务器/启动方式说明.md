# Art Design Pro 启动方式详细说明

## 🎯 **核心概念**

### 🔑 **两个版本的区别**
- **内部版本** ✅ = 在**当前Cursor终端**中运行（不开新窗口）
- **外部版本** = 打开**独立的外部窗口**

### 🚀 **两个服务**
- **后台管理系统** = `http://localhost:3006/` (admin/)
- **后端API服务** = `http://localhost:3001/api/` (backend/)

---

## 🚀 **启动方式大全**

### 方式一：快速启动（日常使用）

#### 🔥 **单独启动后台管理**
```bash
# 在项目根目录运行
& "网站工具\启动服务器\内部\快速启动后台.bat"
```

#### 🔥 **单独启动后端API**
```bash
# 在项目根目录运行
& "网站工具\启动服务器\内部\快速启动后端.bat"
```

#### 🔥 **同时启动两个服务**
```bash
# 第一条命令（启动后端）
& "网站工具\启动服务器\内部\快速启动后端.bat"

# 第二条命令（启动后台）- 在新终端标签中运行
& "网站工具\启动服务器\内部\快速启动后台.bat"
```

### 方式二：菜单启动（推荐）

#### 📋 **使用内部菜单**
```bash
# 1. 切换到内部目录
cd "网站工具\启动服务器\内部"

# 2. 运行菜单
.\菜单.bat

# 3. 选择对应选项
# [1] 启动后台管理系统 (完整检查)
# [2] 启动后端API服务 (完整检查)
# [3] 停止所有服务器
# [4] 检查配置依赖
# [5] 退出
```

### 方式三：外部窗口启动

#### 🖥️ **双击运行（独立窗口）**
- **后台管理**: 双击 `网站工具\启动服务器\外部\快速启动后台.bat`
- **后端API**: 双击 `网站工具\启动服务器\外部\快速启动后端.bat`
- **菜单方式**: 双击 `网站工具\启动服务器\外部\菜单.bat`

---

## 📋 **详细启动步骤**

### 🎯 **推荐启动流程（Cursor开发者）**

#### **第一次启动（完整检查）**

1. **打开Cursor终端**
2. **启动后端API服务**：
   ```bash
   cd "网站工具\启动服务器\内部"
   .\菜单.bat
   # 选择 [2] 启动后端API服务 (完整检查)
   ```

3. **新建终端标签**（Ctrl+Shift+`）
4. **启动后台管理系统**：
   ```bash
   cd "网站工具\启动服务器\内部"
   .\菜单.bat
   # 选择 [1] 启动后台管理系统 (完整检查)
   ```

#### **日常启动（快速模式）**

1. **第一个终端标签**：
   ```bash
   & "网站工具\启动服务器\内部\快速启动后端.bat"
   ```

2. **第二个终端标签**：
   ```bash
   & "网站工具\启动服务器\内部\快速启动后台.bat"
   ```

### 🎯 **独立使用流程**

#### **第一次启动**
1. **双击**：`网站工具\启动服务器\外部\菜单.bat`
2. **选择**：`[2] 启动后端API服务 (完整检查)`
3. **再次双击**：`网站工具\启动服务器\外部\菜单.bat`
4. **选择**：`[1] 启动后台管理系统 (完整检查)`

#### **日常启动**
1. **双击**：`网站工具\启动服务器\外部\快速启动后端.bat`
2. **双击**：`网站工具\启动服务器\外部\快速启动后台.bat`

---

## ⚡ **快速命令参考**

### 🔥 **常用启动命令**
```bash
# === 在项目根目录运行 ===

# 快速启动后端API
& "网站工具\启动服务器\内部\快速启动后端.bat"

# 快速启动后台管理
& "网站工具\启动服务器\内部\快速启动后台.bat"

# 主菜单
cd "网站工具\启动服务器\内部" && .\菜单.bat

# 停止所有服务
& "网站工具\启动服务器\内部\其他启动\停止服务器.bat"

# 检查配置
& "网站工具\启动服务器\内部\其他启动\检查配置依赖.bat"
```

### 🌐 **访问地址**
```
后台管理系统：http://localhost:3006/
后端API服务：  http://localhost:3001/api/
API健康检查：  http://localhost:3001/api/health
API文档：      http://localhost:3001/api/docs
Vue DevTools：http://localhost:3006/__devtools__/
PostgreSQL：  localhost:5432 (user: postgres, pass: password)
Redis缓存：    localhost:6379
```

---

## 🚨 **启动前准备**

### ✅ **必须完成的步骤**

1. **确保数据库服务已安装和启动**：
   ```bash
   # 检查PostgreSQL服务状态
   sc query postgresql-x64-15
   
   # 如未启动，以管理员身份运行
   net start postgresql-x64-15
   
   # 检查Redis/Memurai（可选，脚本会自动启动）
   tasklist | findstr "memurai.exe"
   ```

2. **确保数据库已配置**：
   ```bash
   cd backend
   # 检查.env文件是否存在
   # 如不存在，脚本会自动从development.env创建
   
   # 生成Prisma客户端
   pnpm db:generate
   
   # 推送数据库模式（首次运行）
   pnpm db:push
   ```

3. **检查端口占用**：
   ```bash
   netstat -ano | findstr ":3006\|:3001\|:5432\|:6379"
   ```

4. **确保依赖已安装**：
   ```bash
   # 后台管理依赖
   cd admin && pnpm install
   
   # 后端API依赖
   cd backend && pnpm install
   ```

### ⚠️ **环境要求**
- **Node.js**: 18.20.4 及以上
- **pnpm**: 会自动安装
- **操作系统**: Windows 10/11
- **PowerShell**: 支持UTF-8编码

---

## 🔧 **故障排除**

### ❌ **常见错误及解决方案**

#### **1. PostgreSQL连接失败**
```
错误: Can't reach database server at localhost:5432
解决: 
# 检查PostgreSQL服务状态
sc query postgresql-x64-15
# 启动PostgreSQL服务（管理员权限）
net start postgresql-x64-15
```

#### **2. PostgreSQL认证失败**
```
错误: Authentication failed against database server
解决: 
# 检查.env文件中的数据库密码配置
# 确保密码正确或按文档重置PostgreSQL密码
```

#### **3. Prisma客户端未初始化**
```
错误: Prisma client not initialized. Please run: pnpm db:generate
解决: cd backend && pnpm db:generate
```

#### **4. 找不到bat文件**
```
错误: 无法将".\快速启动后端.bat"项识别为 cmdlet
解决: 使用完整路径 & "网站工具\启动服务器\内部\快速启动后端.bat"
```

#### **5. 端口被占用**
```
错误: 端口3006、3001、5432或6379已被占用
解决: & "网站工具\启动服务器\内部\其他启动\停止服务器.bat"
```

#### **6. Redis连接失败（非致命）**
```
警告: Redis connection failed - running without cache
解决: 
# Redis是可选服务，不影响核心功能
# 如需使用缓存，启动脚本会自动尝试启动Redis
```

#### **7. 依赖安装失败**
```
错误: 依赖安装失败
解决: 
cd admin (或 backend)
Remove-Item -Recurse -Force node_modules
pnpm install
```

### 🔄 **重新启动流程**

1. **停止所有服务**：
   ```bash
   & "网站工具\启动服务器\内部\其他启动\停止服务器.bat"
   ```

2. **检查配置**：
   ```bash
   & "网站工具\启动服务器\内部\其他启动\检查配置依赖.bat"
   ```

3. **重新启动**：
   ```bash
   # 启动后端
   & "网站工具\启动服务器\内部\快速启动后端.bat"
   
   # 启动后台
   & "网站工具\启动服务器\内部\快速启动后台.bat"
   ```

---

## 🎯 **启动成功标志**

### ✅ **后端API服务启动成功**
```
[nodemon] starting `ts-node src/app.ts`
🔗 Redis connected successfully
✅ Redis connected successfully
✅ PostgreSQL connected successfully
prisma:query SELECT 1
🚀 Server running on port 3001
🌐 API available at: http://localhost:3001/api/
```

### ✅ **后台管理系统启动成功**
```
VITE v6.1.1  ready in 2075 ms
➜  Local:   http://localhost:3006/
➜  Network: http://192.168.x.x:3006/
➜  Vue DevTools: Open http://localhost:3006/__devtools__/
```

### ✅ **服务可访问性测试**
```bash
# 测试前端管理系统
curl http://localhost:3006

# 测试后端API健康检查
curl http://localhost:3001/api/health

# 测试数据库连接
curl http://localhost:3001/api/health | grep -E "postgres|redis"

# 检查所有服务端口
netstat -an | findstr ":3006\|:3001\|:5432\|:6379"
```

---

## 💡 **最佳实践**

### 🚀 **开发环境推荐**

1. **使用内部版本**（在Cursor终端中）
2. **确保数据库服务先启动**（PostgreSQL、Redis）
3. **先启动后端API**，再启动前端管理
4. **使用快速启动**进行日常开发
5. **使用完整启动**进行首次启动或故障排查
6. **定期备份数据库**和重要配置文件

### 🎯 **启动顺序建议**

```
1. 数据库服务
   PostgreSQL (localhost:5432) ✅
   Redis/Memurai (localhost:6379) ✅
   ↓
2. 后端API服务 (localhost:3001)
   ↓
3. 前端管理系统 (localhost:3006)
   ↓
4. 打开浏览器访问和测试
```

### 🔄 **多服务管理**

- **推荐**: 使用两个Cursor终端标签
- **备选**: 使用外部版本打开两个独立窗口
- **调试**: 菜单方式逐个启动，便于问题定位

---

## 📞 **需要帮助？**

### 🔍 **自诊断步骤**
1. 运行 `检查配置依赖.bat`
2. 查看终端错误信息
3. 检查端口占用情况
4. 验证Node.js和pnpm版本

### 🚨 **紧急解决方案**
```bash
# 完全重置
& "网站工具\启动服务器\内部\其他启动\停止服务器.bat"
cd admin && Remove-Item -Recurse -Force node_modules && pnpm install
cd backend && Remove-Item -Recurse -Force node_modules && pnpm install && pnpm db:generate
```

**🎊 现在您已经掌握了Art Design Pro的所有启动方式！选择最适合您的方式开始开发吧！** 🚀 