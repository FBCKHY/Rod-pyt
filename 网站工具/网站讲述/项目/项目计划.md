# Art Design Pro 后端建设项目计划

## 📋 项目概述

### 🎯 项目目标
建设Art Design Pro真实后端服务，替换当前的Mock数据，为前端管理系统提供完整的API支持，并预留扩展接口为后续前端连接做准备。

### 📊 当前状态
- ✅ **前端现状**: Vue3 + TypeScript + Element Plus，UI完整
- ❌ **后端现状**: 无真实后端服务，使用ApiFox Mock数据
- 🎯 **主要任务**: 建设后端API服务 + 预留前端连接接口

---

## 🏗️ 系统架构分析

### 📱 三层架构关系图
```
┌─────────────────┐    API请求    ┌─────────────────┐    数据操作    ┌─────────────────┐
│  前端展示网站    │ ────────────► │  后端API服务     │ ────────────► │     数据库       │
│  (web Site/)    │               │  (backend/)     │               │  (PostgreSQL)   │
└─────────────────┘               └─────────────────┘               └─────────────────┘
                                         ▲
                                         │ 管理请求
                                         │
                                  ┌─────────────────┐
                                  │  后台管理系统    │
                                  │  (admin/)       │
                                  └─────────────────┘
```

### 📁 项目根目录结构
```
oai 0/                          # 项目根目录
├── admin/                      # 后台管理系统（Vue3 + TypeScript）
│   ├── src/
│   ├── package.json
│   └── vite.config.ts
├── backend/                    # 后端API服务（待建设）
│   ├── src/
│   ├── prisma/
│   ├── package.json
│   └── README.md
├── web Site/                   # 前端展示网站
│   ├── web PC/
│   └── web Mobile/
└── 网站工具/                    # 工具和文档
    ├── 启动服务器/
    └── 网站讲述/
```

### 🔍 现有后台架构深度分析

#### ✅ **HTTP请求架构**（已完善）
```typescript
// admin/src/utils/http/index.ts
- 基础URL配置: VITE_API_URL
- 认证机制: Bearer Token (Authorization header)
- 响应格式: { code: number, msg: string, data: T }
- 错误处理: 统一错误拦截和重试机制
- 请求超时: 15秒超时配置
```

#### ✅ **API类型定义**（已完善）
```typescript
// admin/src/typings/api.d.ts
declare namespace Api {
  Http.BaseResponse<T>           // 统一响应格式
  Common.PaginatingParams        // 分页参数
  Auth.LoginParams/LoginResponse // 认证相关
  User.UserInfo/UserListData     // 用户管理
  Product.ProductInfo           // 产品管理（我们已添加）
}
```

#### ✅ **权限控制机制**（已完善）
```typescript
// 角色权限: ['R_SUPER', 'R_ADMIN']
// 按钮权限: ['product:add', 'product:edit', 'product:delete']
// 菜单权限: authList配置数组
```

#### ✅ **现有功能模块**
```
Dashboard (仪表盘)
├── Console (控制台)

System (系统管理)
├── User (用户管理)
├── Role (角色管理)
├── Menu (菜单管理)
├── UserCenter (用户中心)

Product (产品管理) ← 我们已添加
├── ProductManage (产品列表+分类管理)

Result (结果页面)
├── Success/Fail

Exception (异常页面)
├── 403/404/500

Auth (认证页面)
├── Login/Register/ForgetPassword
```

### ❌ **需要解决的核心问题**

#### 1. **API Mock数据替换**
```bash
# 当前配置
VITE_API_URL = https://m1.apifoxmock.com/m1/6400575-6097373-default

# 需要切换为真实后端
VITE_API_URL = http://localhost:3001/api
```

#### 2. **权限模式切换**
```bash
# 当前模式：前端控制权限
VITE_ACCESS_MODE = frontend

# 需要切换为后端控制
VITE_ACCESS_MODE = backend
```

#### 3. **数据持久化缺失**
- 用户认证数据
- 产品和分类数据
- 菜单权限数据
- 操作日志数据

---

## 🏗️ 技术架构选择

### 后端技术栈：Node.js + Express + TypeScript
```
运行时：Node.js 18+
框架：Express.js
语言：TypeScript
数据库：PostgreSQL + Redis
ORM：Prisma
认证：JWT + Refresh Token
文档：Swagger/OpenAPI
部署：Docker + PM2
```

### 数据库设计（基于现有API类型）
```sql
-- 用户表 (对应 Api.User.UserInfo)
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    user_name VARCHAR(50) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    roles TEXT[] DEFAULT ARRAY['user'],
    buttons TEXT[] DEFAULT ARRAY[],
    avatar VARCHAR(500),
    email VARCHAR(100),
    phone VARCHAR(20),
    status VARCHAR(10) DEFAULT '1', -- '1':在线 '2':离线 '3':异常 '4':注销
    create_time TIMESTAMP DEFAULT NOW(),
    update_time TIMESTAMP DEFAULT NOW()
);

-- 产品表 (对应 Api.Product.ProductInfo)
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    code VARCHAR(100),
    category VARCHAR(100) NOT NULL,
    category_id INTEGER NOT NULL,
    price DECIMAL(10,2) NOT NULL,
    original_price DECIMAL(10,2),
    stock INTEGER DEFAULT 0,
    description TEXT,
    images TEXT[],
    status VARCHAR(10) DEFAULT 'active', -- 'active' | 'inactive'
    create_time TIMESTAMP DEFAULT NOW(),
    update_time TIMESTAMP DEFAULT NOW()
);

-- 分类表 (对应 Api.Product.CategoryInfo)
CREATE TABLE categories (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    code VARCHAR(50) UNIQUE NOT NULL,
    description TEXT,
    sort INTEGER DEFAULT 0,
    status VARCHAR(10) DEFAULT 'active',
    level INTEGER DEFAULT 1,
    parent_id INTEGER REFERENCES categories(id),
    create_time TIMESTAMP DEFAULT NOW(),
    update_time TIMESTAMP DEFAULT NOW()
);
```

---

## 📅 阶段化开发计划

# 🚀 第一阶段：后端基础架构搭建 (1周)

## 📌 阶段目标
搭建完整的后端项目框架，配置开发环境，建立数据库连接

## ✅ 任务清单

### Day 1-2: 项目初始化
- [x] 创建后端项目目录结构 ✅ **已完成 - 2024.12.29**
- [x] 配置TypeScript开发环境 ✅ **已完成 - 2024.12.29**
- [x] 安装核心依赖包 ✅ **已完成 - 2024.12.29**
- [x] 设置代码规范 (ESLint + Prettier) ✅ **已完成 - 2024.12.29**
- [x] 配置环境变量管理 ✅ **已完成 - 2024.12.29**

### Day 3-4: 数据库搭建
- [x] 设计数据库表结构 ✅ **已完成 - 2024.12.29**
- [x] 配置PostgreSQL数据库 ✅ **已完成 - 2024.12.29**
- [x] 设置Redis缓存服务 ✅ **已完成 - 2024.12.29**
- [x] 创建Prisma数据模型 ✅ **已完成 - 2024.12.29**
- [x] 运行数据库迁移 ✅ **已完成 - 2024.12.29**

### Day 5: 基础服务配置
- [x] HTTP服务器配置 ✅ **已完成 - 2024.12.29**
- [x] 中间件设置 (CORS, 日志, 错误处理) ✅ **已完成 - 2024.12.29**
- [x] 健康检查端点 ✅ **已完成 - 2024.12.29**
- [x] 基础响应格式统一 ✅ **已完成 - 2024.12.29**

## 📦 交付物
- 完整的后端项目结构
- 数据库连接和基础表
- 基础HTTP服务运行
- 开发环境配置完成

---

# 🔧 第二阶段：核心API开发 (1.5周)

## 📌 阶段目标
开发核心业务API，实现用户认证、权限管理、菜单管理等核心功能

## ✅ 任务清单

### Week 1: 认证和用户系统
- [ ] **用户认证API**
  - [ ] POST /api/auth/login (用户登录)
  - [ ] POST /api/auth/logout (用户登出)
  - [ ] POST /api/auth/refresh (刷新Token)
  - [ ] JWT Token生成和验证

- [ ] **用户管理API**
  - [ ] GET /api/users (获取用户列表)
  - [ ] GET /api/users/:id (获取用户详情)
  - [ ] POST /api/users (创建用户)
  - [ ] PUT /api/users/:id (更新用户)
  - [ ] DELETE /api/users/:id (删除用户)

### Week 2: 权限和菜单系统
- [ ] **菜单管理API**
  - [ ] GET /api/menus/tree (获取菜单树)
  - [ ] POST /api/menus (创建菜单)
  - [ ] PUT /api/menus/:id (更新菜单)
  - [ ] DELETE /api/menus/:id (删除菜单)

- [ ] **角色权限API**
  - [ ] GET /api/roles (获取角色列表)
  - [ ] POST /api/roles (创建角色)
  - [ ] PUT /api/roles/:id (更新角色)
  - [ ] GET /api/permissions (获取权限列表)

## 📦 交付物
- 完整的认证系统
- 用户管理CRUD接口
- 动态菜单API
- 角色权限控制API

---

# �� 第三阶段：业务API开发 (1周)

## 📌 阶段目标
开发产品管理、分类管理等业务功能API

## ✅ 任务清单

### Day 1-3: 产品管理API
- [ ] **产品管理API**
  - [ ] GET /api/products (获取产品列表)
  - [ ] GET /api/products/:id (获取产品详情)
  - [ ] POST /api/products (创建产品)
  - [ ] PUT /api/products/:id (更新产品)
  - [ ] DELETE /api/products/:id (删除产品)
  - [ ] GET /api/products/search (产品搜索)

### Day 4-5: 分类管理API
- [ ] **分类管理API**
  - [ ] GET /api/categories/tree (获取分类树)
  - [ ] POST /api/categories (创建分类)
  - [ ] PUT /api/categories/:id (更新分类)
  - [ ] DELETE /api/categories/:id (删除分类)

### Day 6-7: 系统功能API
- [ ] **文件管理API**
  - [ ] POST /api/files/upload (文件上传)
  - [ ] GET /api/files/:id (文件下载)
  - [ ] DELETE /api/files/:id (删除文件)

- [ ] **系统监控API**
  - [ ] GET /api/system/info (系统信息)
  - [ ] GET /api/system/logs (操作日志)

## 📦 交付物
- 产品管理完整API
- 分类管理API
- 文件上传下载功能
- 系统监控接口

---

# 📋 第四阶段：接口完善和文档 (0.5周)

## 📌 阶段目标
完善API接口，生成接口文档，为前端连接做准备

## ✅ 任务清单

### Day 1-2: 接口优化
- [ ] API响应格式统一
- [ ] 错误处理完善
- [ ] 数据验证增强
- [ ] 权限验证中间件完善

### Day 3: 文档和测试
- [ ] Swagger API文档生成
- [ ] 接口测试覆盖
- [ ] 性能基准测试
- [ ] 安全测试验证

## 📦 交付物
- 完整的API文档
- 接口测试报告
- 性能测试结果
- 前端连接接口规范

---

# 🔗 第五阶段：前端连接预留 (待后续执行)

## 📌 阶段目标
基于现有架构分析，精确预留前端连接接口，确保无缝对接

## ✅ 精确接口预留清单

### 🎯 **严格遵循现有响应格式**
```typescript
// 必须完全匹配现有格式: admin/src/typings/api.d.ts
interface ApiResponse<T = any> {
  code: number  // 状态码
  msg: string   // 消息
  data: T       // 数据
}

// 成功响应示例
{
  "code": 200,
  "msg": "success", 
  "data": {...}
}
```

### 🔑 **权限验证接口预留**
```typescript
// 基于现有用户权限结构
interface UserInfo {
  userId: number
  userName: string
  roles: string[]        // ['R_SUPER', 'R_ADMIN']
  buttons: string[]      // ['product:add', 'product:edit']
  avatar?: string
  email?: string
}

// 菜单权限预留
interface MenuPermission {
  roles: string[]
  authList: Array<{
    title: string
    authMark: string
  }>
}
```

### 📊 **现有API端点对应关系**
```typescript
// 现有前端调用 → 后端需要实现的端点
UserService.login() → POST /api/auth/login
UserService.getUserInfo() → GET /api/user/info  
UserService.getUserList() → GET /api/user/list

// 产品管理API（基于我们已有的类型定义）
ProductService.getProductList() → GET /api/products
ProductService.createProduct() → POST /api/products
ProductService.getCategoryTree() → GET /api/categories/tree
```

### 🛠️ **HTTP工具兼容性确保**
```typescript
// 后端必须支持现有的请求配置
// admin/src/utils/http/index.ts
- Authorization: Bearer ${token}
- Content-Type: application/json
- 超时时间: 15秒
- 重试机制: 2次重试
- 错误状态码处理: 401自动登出
```

## 📋 **分阶段连接计划**

### 🔄 **Phase A: 环境配置切换**
```bash
# Step 1: 修改环境变量
admin/.env.development:
- VITE_API_URL: Mock地址 → http://localhost:3001/api
- VITE_ACCESS_MODE: frontend → backend  
- VITE_WITH_CREDENTIALS: false → true

# Step 2: 验证连接
- 健康检查: GET /api/health
- 认证测试: POST /api/auth/login
```

### 🔄 **Phase B: 核心功能切换**  
```bash
# Step 1: 用户认证系统
- 登录接口切换
- Token验证机制
- 用户信息获取

# Step 2: 权限控制切换
- 角色权限验证
- 菜单权限过滤
- 按钮权限控制
```

### 🔄 **Phase C: 业务功能切换**
```bash
# Step 1: 产品管理
- 产品列表API切换
- 产品CRUD操作
- 分类管理API切换

# Step 2: 系统管理
- 用户管理API切换
- 角色管理API切换
- 菜单管理API切换
```

### 🔄 **Phase D: 完整性验证**
```bash
# Step 1: 功能测试
- 所有CRUD操作验证
- 权限控制验证
- 数据一致性验证

# Step 2: 性能测试  
- 接口响应时间
- 并发请求处理
- 错误处理机制
```

## 🎯 **连接成功标准**

### ✅ **技术标准**
- [ ] 所有现有API调用无需修改代码
- [ ] 响应格式100%兼容现有类型定义
- [ ] 权限控制机制完全对接
- [ ] 错误处理机制保持一致

### ✅ **功能标准**
- [ ] 用户登录/登出正常
- [ ] 菜单权限显示正确
- [ ] 产品管理功能完整
- [ ] 分页查询正常工作
- [ ] 文件上传下载正常

### ✅ **性能标准**
- [ ] API响应时间 < 200ms
- [ ] 前端加载时间无明显增加
- [ ] 并发用户支持 ≥ 50人
- [ ] 数据库查询优化完成

---

## 🛠️ 开发环境配置

### 后端项目结构
```
backend/
├── src/
│   ├── controllers/         # 控制器层
│   ├── services/           # 业务逻辑层
│   ├── models/             # 数据模型层
│   ├── middleware/         # 中间件
│   ├── routes/             # 路由定义
│   ├── utils/              # 工具函数
│   ├── config/             # 配置文件
│   └── app.ts              # 应用入口
├── prisma/                 # 数据库配置
├── tests/                  # 测试文件
├── docs/                   # API文档
└── package.json
```

### 环境依赖安装
```bash
# 核心依赖
npm install express cors helmet compression
npm install jsonwebtoken bcryptjs
npm install prisma @prisma/client
npm install redis ioredis
npm install winston multer joi

# 开发依赖
npm install -D typescript @types/node nodemon ts-node
npm install -D @types/express @types/cors @types/jsonwebtoken
npm install -D jest @types/jest supertest
```

---

## 📊 阶段验收标准

### 第一阶段验收
- [ ] 项目可以正常启动
- [ ] 数据库连接成功
- [ ] 基础健康检查接口可访问
- [ ] 开发环境配置完整

### 第二阶段验收
- [ ] 用户可以正常登录登出
- [ ] JWT Token验证正常
- [ ] 菜单树可以正常获取
- [ ] 角色权限控制生效

### 第三阶段验收
- [ ] 产品CRUD操作正常
- [ ] 分类管理功能完整
- [ ] 文件上传下载正常
- [ ] 系统监控数据准确

### 第四阶段验收
- [ ] API文档完整准确
- [ ] 所有接口测试通过
- [ ] 性能指标达标
- [ ] 安全测试通过

---

## 🎯 项目里程碑

| 阶段 | 目标 | 预计时间 | 关键交付物 |
|------|------|----------|------------|
| 第一阶段 | 基础架构搭建 | 1周 | 项目框架 + 数据库 |
| 第二阶段 | 核心API开发 | 1.5周 | 认证 + 用户 + 菜单API |
| 第三阶段 | 业务API开发 | 1周 | 产品 + 分类 + 文件API |
| 第四阶段 | 接口完善 | 0.5周 | API文档 + 测试报告 |
| 第五阶段 | 前端连接 | 待定 | 前后端集成完成 |

---

## 🚀 开始执行

### 立即可以开始的任务
1. **创建backend/项目目录**
2. **配置Node.js开发环境**
3. **安装基础依赖包**
4. **设计数据库表结构**

### 下一步行动
📅 **开始时间**: 现在可以开始  
⏰ **第一阶段预计完成**: 1周后  
👥 **建议团队**: 1-2个后端开发人员

**准备好开始第一阶段了吗？我们可以立即开始创建后端项目结构！**

---

## 🎯 **总结：本计划的完整性和可行性**

### ✅ **前端、后台、后端关系明确**
- **前端展示网站** (web Site/) ← 产品展示，从后端获取数据
- **后台管理系统** (admin/) ← 数据管理，通过API操作后端
- **后端API服务** (待建设) ← 数据处理，连接数据库

### ✅ **深度分析现有架构**
- HTTP请求工具：完全兼容现有的`admin/src/utils/http/index.ts`
- API类型定义：严格遵循`admin/src/typings/api.d.ts`规范
- 权限控制：支持现有的roles和buttons权限机制
- 响应格式：100%匹配`{ code, msg, data }`格式

### ✅ **精确的接口预留**
- 所有API端点与现有前端调用完全对应
- 数据库表结构与API类型定义完全匹配
- 环境配置切换方案详细可执行
- 分阶段连接计划具体可操作

### ✅ **后续工作充分考虑**
- 分阶段验收标准：每阶段都有明确的完成标准
- 连接成功标准：技术、功能、性能三维度验证
- 现有功能支持：Dashboard、System、Product等所有模块
- 扩展性预留：为未来功能添加预留空间

### 🚀 **执行保障**
这个计划基于对现有代码的深度分析，确保：
1. **无缝对接**：前端代码无需修改即可连接后端
2. **渐进式切换**：从Mock数据到真实API的平滑过渡
3. **完整功能覆盖**：支持现有所有后台管理功能
4. **未来扩展性**：为新功能添加预留充足接口

**这是一个经过深度分析、完全可执行的后端建设方案！**
