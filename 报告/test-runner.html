<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿæµ‹è¯•å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
        }

        .test-panel {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .test-section {
            margin-bottom: 30px;
        }

        .test-section h2 {
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .test-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .results {
            background: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            max-height: 500px;
            overflow-y: auto;
        }

        .log-entry {
            padding: 8px 12px;
            margin-bottom: 8px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .log-info {
            background: #dbeafe;
            color: #1e40af;
        }

        .log-success {
            background: #d1fae5;
            color: #065f46;
        }

        .log-error {
            background: #fee2e2;
            color: #991b1b;
        }

        .log-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
        }

        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>ğŸ§ª äº§å“ä¸­å¿ƒç³»ç»Ÿæµ‹è¯•å·¥å…·</h1>
            <p class="subtitle">è‡ªåŠ¨åŒ–æµ‹è¯•æ‰€æœ‰APIæ¥å£å’ŒåŠŸèƒ½æ¨¡å—</p>
        </div>

        <!-- æµ‹è¯•é¢æ¿ -->
        <div class="test-panel">
            <!-- APIæµ‹è¯• -->
            <div class="test-section">
                <h2>ğŸ“¡ APIæ¥å£æµ‹è¯•</h2>
                <div class="test-buttons">
                    <button class="btn-primary" onclick="testProductList()">æµ‹è¯•äº§å“åˆ—è¡¨</button>
                    <button class="btn-primary" onclick="testProductDetail()">æµ‹è¯•äº§å“è¯¦æƒ…</button>
                    <button class="btn-primary" onclick="testCategoryList()">æµ‹è¯•åˆ†ç±»åˆ—è¡¨</button>
                    <button class="btn-primary" onclick="testOrderCreate()">æµ‹è¯•è®¢å•åˆ›å»º</button>
                    <button class="btn-success" onclick="runAllAPITests()">è¿è¡Œæ‰€æœ‰APIæµ‹è¯•</button>
                </div>
            </div>

            <!-- å‰ç«¯æµ‹è¯• -->
            <div class="test-section">
                <h2>ğŸŒ å‰ç«¯åŠŸèƒ½æµ‹è¯•</h2>
                <div class="test-buttons">
                    <button class="btn-primary" onclick="testProductCenterPage()">æµ‹è¯•äº§å“ä¸­å¿ƒ</button>
                    <button class="btn-primary" onclick="testProductDetailPage()">æµ‹è¯•äº§å“è¯¦æƒ…</button>
                    <button class="btn-primary" onclick="testOrderPage()">æµ‹è¯•è®¢è´­é¡µé¢</button>
                    <button class="btn-success" onclick="runAllFrontendTests()">è¿è¡Œæ‰€æœ‰å‰ç«¯æµ‹è¯•</button>
                </div>
            </div>

            <!-- é›†æˆæµ‹è¯• -->
            <div class="test-section">
                <h2>ğŸ”— é›†æˆæµ‹è¯•</h2>
                <div class="test-buttons">
                    <button class="btn-primary" onclick="testEndToEndFlow()">ç«¯åˆ°ç«¯æµç¨‹æµ‹è¯•</button>
                    <button class="btn-primary" onclick="testDataConsistency()">æ•°æ®ä¸€è‡´æ€§æµ‹è¯•</button>
                    <button class="btn-danger" onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
                    <button class="btn-success" onclick="runAllTests()">è¿è¡Œå…¨éƒ¨æµ‹è¯•</button>
                </div>
            </div>

            <!-- ç»Ÿè®¡ä¿¡æ¯ -->
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalTests">0</div>
                    <div class="stat-label">æ€»æµ‹è¯•æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="passedTests">0</div>
                    <div class="stat-label">é€šè¿‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="failedTests">0</div>
                    <div class="stat-label">å¤±è´¥</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="successRate">0%</div>
                    <div class="stat-label">æˆåŠŸç‡</div>
                </div>
            </div>

            <!-- è¿›åº¦æ¡ -->
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar" style="width: 0%"></div>
            </div>

            <!-- æµ‹è¯•ç»“æœ -->
            <div class="results" id="results">
                <div class="log-entry log-info">
                    ğŸ“‹ å‡†å¤‡å°±ç»ªï¼Œç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...
                </div>
            </div>
        </div>
    </div>

    <script>
        // æµ‹è¯•ç»Ÿè®¡
        const stats = {
            total: 0,
            passed: 0,
            failed: 0
        };

        // APIåŸºç¡€URL
        const API_BASE_URL = 'http://localhost:3001/api';

        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            results.appendChild(entry);
            results.scrollTop = results.scrollHeight;
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            document.getElementById('totalTests').textContent = stats.total;
            document.getElementById('passedTests').textContent = stats.passed;
            document.getElementById('failedTests').textContent = stats.failed;
            
            const rate = stats.total > 0 ? (stats.passed / stats.total * 100).toFixed(1) : 0;
            document.getElementById('successRate').textContent = rate + '%';
            document.getElementById('progressBar').style.width = rate + '%';
        }

        // æ¸…ç©ºç»“æœ
        function clearResults() {
            document.getElementById('results').innerHTML = '';
            stats.total = 0;
            stats.passed = 0;
            stats.failed = 0;
            updateStats();
            log('ç»“æœå·²æ¸…ç©º', 'info');
        }

        // æµ‹è¯•äº§å“åˆ—è¡¨
        async function testProductList() {
            log('ğŸ§ª å¼€å§‹æµ‹è¯•äº§å“åˆ—è¡¨æ¥å£...', 'info');
            stats.total++;
            
            try {
                const response = await fetch(`${API_BASE_URL}/products?page=1&limit=10`);
                const data = await response.json();
                
                if (response.status === 200 && data.data) {
                    stats.passed++;
                    log('âœ… äº§å“åˆ—è¡¨æ¥å£æµ‹è¯•é€šè¿‡', 'success');
                    log(`   è¿”å› ${data.data.items?.length || data.data.data?.length || 0} ä¸ªäº§å“`, 'info');
                } else {
                    throw new Error('å“åº”æ ¼å¼ä¸æ­£ç¡®');
                }
            } catch (error) {
                stats.failed++;
                log(`âŒ äº§å“åˆ—è¡¨æ¥å£æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
            
            updateStats();
        }

        // æµ‹è¯•äº§å“è¯¦æƒ…
        async function testProductDetail() {
            log('ğŸ§ª å¼€å§‹æµ‹è¯•äº§å“è¯¦æƒ…æ¥å£...', 'info');
            stats.total++;
            
            try {
                const response = await fetch(`${API_BASE_URL}/products/1`);
                const data = await response.json();
                
                if (response.status === 200 && data.data) {
                    stats.passed++;
                    log('âœ… äº§å“è¯¦æƒ…æ¥å£æµ‹è¯•é€šè¿‡', 'success');
                    log(`   äº§å“åç§°: ${data.data.name}`, 'info');
                } else {
                    throw new Error('å“åº”æ ¼å¼ä¸æ­£ç¡®');
                }
            } catch (error) {
                stats.failed++;
                log(`âŒ äº§å“è¯¦æƒ…æ¥å£æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
            
            updateStats();
        }

        // æµ‹è¯•åˆ†ç±»åˆ—è¡¨
        async function testCategoryList() {
            log('ğŸ§ª å¼€å§‹æµ‹è¯•åˆ†ç±»åˆ—è¡¨æ¥å£...', 'info');
            stats.total++;
            
            try {
                const response = await fetch(`${API_BASE_URL}/product-categories`);
                const data = await response.json();
                
                if (response.status === 200 && data.data) {
                    stats.passed++;
                    log('âœ… åˆ†ç±»åˆ—è¡¨æ¥å£æµ‹è¯•é€šè¿‡', 'success');
                    log(`   è¿”å› ${data.data.data?.length || data.data.length || 0} ä¸ªåˆ†ç±»`, 'info');
                } else {
                    throw new Error('å“åº”æ ¼å¼ä¸æ­£ç¡®');
                }
            } catch (error) {
                stats.failed++;
                log(`âŒ åˆ†ç±»åˆ—è¡¨æ¥å£æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
            
            updateStats();
        }

        // æµ‹è¯•è®¢å•åˆ›å»º
        async function testOrderCreate() {
            log('ğŸ§ª å¼€å§‹æµ‹è¯•è®¢å•åˆ›å»ºæ¥å£...', 'info');
            stats.total++;
            
            const orderData = {
                customerName: 'æµ‹è¯•ç”¨æˆ·',
                customerPhone: '13800138000',
                customerEmail: 'test@example.com',
                province: 'å¹¿ä¸œçœ',
                city: 'æ·±åœ³å¸‚',
                district: 'å—å±±åŒº',
                address: 'æµ‹è¯•åœ°å€123å·',
                postalCode: '518000',
                totalAmount: 999.00,
                status: 'pending',
                items: [
                    {
                        productId: 1,
                        productName: 'æµ‹è¯•äº§å“',
                        productModel: 'TEST-001',
                        quantity: 1,
                        price: 999.00,
                        subtotal: 999.00
                    }
                ]
            };
            
            try {
                const response = await fetch(`${API_BASE_URL}/orders`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(orderData)
                });
                const data = await response.json();
                
                if (response.status === 200 && data.data) {
                    stats.passed++;
                    log('âœ… è®¢å•åˆ›å»ºæ¥å£æµ‹è¯•é€šè¿‡', 'success');
                    log(`   è®¢å•å·: ${data.data.orderNumber || data.data.order_number}`, 'info');
                } else {
                    throw new Error('å“åº”æ ¼å¼ä¸æ­£ç¡®');
                }
            } catch (error) {
                stats.failed++;
                log(`âŒ è®¢å•åˆ›å»ºæ¥å£æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
            
            updateStats();
        }

        // æµ‹è¯•äº§å“ä¸­å¿ƒé¡µé¢
        async function testProductCenterPage() {
            log('ğŸ§ª å¼€å§‹æµ‹è¯•äº§å“ä¸­å¿ƒé¡µé¢...', 'info');
            stats.total++;
            
            try {
                const url = 'http://localhost:8080/pages/products.html';
                const response = await fetch(url);
                
                if (response.status === 200) {
                    stats.passed++;
                    log('âœ… äº§å“ä¸­å¿ƒé¡µé¢å¯è®¿é—®', 'success');
                    log(`   å»ºè®®æ‰‹åŠ¨è®¿é—®: ${url}`, 'info');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                stats.failed++;
                log(`âŒ äº§å“ä¸­å¿ƒé¡µé¢æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
            
            updateStats();
        }

        // æµ‹è¯•äº§å“è¯¦æƒ…é¡µé¢
        async function testProductDetailPage() {
            log('ğŸ§ª å¼€å§‹æµ‹è¯•äº§å“è¯¦æƒ…é¡µé¢...', 'info');
            stats.total++;
            
            try {
                const url = 'http://localhost:8080/pages/product-detail.html';
                const response = await fetch(url);
                
                if (response.status === 200) {
                    stats.passed++;
                    log('âœ… äº§å“è¯¦æƒ…é¡µé¢å¯è®¿é—®', 'success');
                    log(`   å»ºè®®æ‰‹åŠ¨è®¿é—®: ${url}?id=1`, 'info');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                stats.failed++;
                log(`âŒ äº§å“è¯¦æƒ…é¡µé¢æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
            
            updateStats();
        }

        // æµ‹è¯•è®¢è´­é¡µé¢
        async function testOrderPage() {
            log('ğŸ§ª å¼€å§‹æµ‹è¯•è®¢è´­é¡µé¢...', 'info');
            stats.total++;
            
            try {
                const url = 'http://localhost:8080/pages/order.html';
                const response = await fetch(url);
                
                if (response.status === 200) {
                    stats.passed++;
                    log('âœ… è®¢è´­é¡µé¢å¯è®¿é—®', 'success');
                    log(`   å»ºè®®æ‰‹åŠ¨è®¿é—®: ${url}?id=1`, 'info');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                stats.failed++;
                log(`âŒ è®¢è´­é¡µé¢æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
            
            updateStats();
        }

        // ç«¯åˆ°ç«¯æµç¨‹æµ‹è¯•
        async function testEndToEndFlow() {
            log('ğŸ§ª å¼€å§‹ç«¯åˆ°ç«¯æµç¨‹æµ‹è¯•...', 'info');
            log('   1. è·å–äº§å“åˆ—è¡¨', 'info');
            await testProductList();
            
            await new Promise(resolve => setTimeout(resolve, 500));
            log('   2. è·å–äº§å“è¯¦æƒ…', 'info');
            await testProductDetail();
            
            await new Promise(resolve => setTimeout(resolve, 500));
            log('   3. åˆ›å»ºè®¢å•', 'info');
            await testOrderCreate();
            
            log('âœ… ç«¯åˆ°ç«¯æµç¨‹æµ‹è¯•å®Œæˆ', 'success');
        }

        // æ•°æ®ä¸€è‡´æ€§æµ‹è¯•
        async function testDataConsistency() {
            log('ğŸ§ª å¼€å§‹æ•°æ®ä¸€è‡´æ€§æµ‹è¯•...', 'info');
            stats.total++;
            
            try {
                // è·å–äº§å“åˆ—è¡¨
                const listResponse = await fetch(`${API_BASE_URL}/products?page=1&limit=10`);
                const listData = await listResponse.json();
                
                if (listData.data && (listData.data.items || listData.data.data)) {
                    const products = listData.data.items || listData.data.data;
                    if (products.length > 0) {
                        const firstProduct = products[0];
                        
                        // è·å–äº§å“è¯¦æƒ…
                        const detailResponse = await fetch(`${API_BASE_URL}/products/${firstProduct.id}`);
                        const detailData = await detailResponse.json();
                        
                        // æ¯”è¾ƒæ•°æ®
                        if (detailData.data.id === firstProduct.id && 
                            detailData.data.name === firstProduct.name) {
                            stats.passed++;
                            log('âœ… æ•°æ®ä¸€è‡´æ€§æµ‹è¯•é€šè¿‡', 'success');
                            log('   åˆ—è¡¨å’Œè¯¦æƒ…æ•°æ®ä¸€è‡´', 'info');
                        } else {
                            throw new Error('åˆ—è¡¨å’Œè¯¦æƒ…æ•°æ®ä¸ä¸€è‡´');
                        }
                    } else {
                        log('âš ï¸  æ²¡æœ‰äº§å“æ•°æ®å¯æµ‹è¯•', 'warning');
                    }
                } else {
                    throw new Error('æ— æ³•è·å–äº§å“åˆ—è¡¨');
                }
            } catch (error) {
                stats.failed++;
                log(`âŒ æ•°æ®ä¸€è‡´æ€§æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
            
            updateStats();
        }

        // è¿è¡Œæ‰€æœ‰APIæµ‹è¯•
        async function runAllAPITests() {
            log('ğŸš€ å¼€å§‹è¿è¡Œæ‰€æœ‰APIæµ‹è¯•...', 'info');
            await testProductList();
            await new Promise(resolve => setTimeout(resolve, 300));
            await testProductDetail();
            await new Promise(resolve => setTimeout(resolve, 300));
            await testCategoryList();
            await new Promise(resolve => setTimeout(resolve, 300));
            await testOrderCreate();
            log('âœ… æ‰€æœ‰APIæµ‹è¯•å®Œæˆ', 'success');
        }

        // è¿è¡Œæ‰€æœ‰å‰ç«¯æµ‹è¯•
        async function runAllFrontendTests() {
            log('ğŸš€ å¼€å§‹è¿è¡Œæ‰€æœ‰å‰ç«¯æµ‹è¯•...', 'info');
            await testProductCenterPage();
            await new Promise(resolve => setTimeout(resolve, 300));
            await testProductDetailPage();
            await new Promise(resolve => setTimeout(resolve, 300));
            await testOrderPage();
            log('âœ… æ‰€æœ‰å‰ç«¯æµ‹è¯•å®Œæˆ', 'success');
        }

        // è¿è¡Œå…¨éƒ¨æµ‹è¯•
        async function runAllTests() {
            clearResults();
            log('ğŸš€ å¼€å§‹è¿è¡Œå…¨éƒ¨æµ‹è¯•...', 'info');
            log('', 'info');
            
            await runAllAPITests();
            log('', 'info');
            
            await runAllFrontendTests();
            log('', 'info');
            
            await testEndToEndFlow();
            log('', 'info');
            
            await testDataConsistency();
            log('', 'info');
            
            log('ğŸ‰ å…¨éƒ¨æµ‹è¯•å®Œæˆï¼', 'success');
            log(`ğŸ“Š æµ‹è¯•ç»“æœ: ${stats.passed}/${stats.total} é€šè¿‡`, 'info');
        }

        // åˆå§‹åŒ–
        updateStats();
    </script>
</body>
</html>
