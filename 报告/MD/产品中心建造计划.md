# 🏗️ 产品中心建造计划

## 📋 项目概述

将已完成的可视化编辑产品详情页面集成到产品中心管理系统中。

---

## ✅ 已完成的工作

### 1. 可视化编辑器 ✅
- **位置**: `产品详情页面模版/通用模板/visual-editor.js`
- **功能**:
  - ✅ 双击编辑文字
  - ✅ 点击上传图片
  - ✅ 撤销/重做 (Ctrl+Z / Ctrl+Shift+Z)
  - ✅ 保存修改到 localStorage
  - ✅ 导出 JSON 配置
  - ✅ 自动标记所有可编辑元素

### 2. 自动可编辑脚本 ✅
- **位置**: `产品详情页面模版/RD-001/自动可编辑.js`
- **功能**: 深度递归扫描，自动为所有文字添加可编辑标记

### 3. 产品详情页面模板 ✅
- **位置**: `产品详情页面模版/RD-001/产品详情.html`
- **状态**: 完整的产品详情页面，已集成编辑器

---

## 🎯 集成目标

### 阶段一：产品管理基础功能
1. **产品列表页面**
   - 显示所有产品
   - 搜索、筛选、排序
   - 添加、编辑、删除产品

2. **产品详情编辑器**
   - 集成可视化编辑器
   - 实时预览
   - 保存到数据库

3. **产品分类管理**
   - 分类树结构
   - 拖拽排序

### 阶段二：高级功能
1. **批量操作**
2. **版本历史**
3. **模板管理**
4. **SEO优化**

---

## 🚀 实施步骤

### Step 1: 创建产品管理模块 (后端)

#### 1.1 数据库设计
```sql
-- 产品表
CREATE TABLE products (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    model VARCHAR(100),
    category_id INT,
    price DECIMAL(10,2),
    card_image VARCHAR(500),
    file_path VARCHAR(500),  -- 产品详情页面路径
    status ENUM('draft', 'published', 'archived') DEFAULT 'draft',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 产品分类表
CREATE TABLE product_categories (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    parent_id INT DEFAULT NULL,
    sort_order INT DEFAULT 0,
    icon VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 产品详情配置表
CREATE TABLE product_configs (
    id INT PRIMARY KEY AUTO_INCREMENT,
    product_id INT NOT NULL,
    config_data JSON,  -- 存储编辑器的修改
    version INT DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (product_id) REFERENCES products(id)
);
```

#### 1.2 API 接口设计
```
GET    /api/products              - 获取产品列表
GET    /api/products/:id          - 获取产品详情
POST   /api/products              - 创建产品
PUT    /api/products/:id          - 更新产品
DELETE /api/products/:id          - 删除产品

GET    /api/products/:id/config   - 获取产品配置
PUT    /api/products/:id/config   - 保存产品配置

GET    /api/categories            - 获取分类列表
POST   /api/categories            - 创建分类
PUT    /api/categories/:id        - 更新分类
DELETE /api/categories/:id        - 删除分类
```

---

### Step 2: 创建产品管理页面 (前端)

#### 2.1 产品列表页面
**文件**: `admin/src/views/products/list.vue`

**功能**:
- 表格展示产品列表
- 搜索框（按名称、型号）
- 筛选器（按分类、状态）
- 操作按钮（编辑、删除、预览）
- 分页

#### 2.2 产品编辑页面
**文件**: `admin/src/views/products/edit.vue`

**功能**:
- 基本信息表单（名称、型号、分类、价格等）
- 图片上传
- 可视化编辑器集成
- 实时预览
- 保存按钮

#### 2.3 产品详情预览
**文件**: `admin/src/views/products/preview.vue`

**功能**:
- iframe 嵌入产品详情页面
- 编辑模式切换
- 全屏预览

---

### Step 3: 集成可视化编辑器

#### 3.1 复制编辑器文件
```bash
# 从
产品详情页面模版/通用模板/visual-editor.js
产品详情页面模版/RD-001/自动可编辑.js

# 到
admin/public/editor/visual-editor.js
admin/public/editor/auto-editable.js
```

#### 3.2 创建编辑器组件
**文件**: `admin/src/components/ProductEditor.vue`

```vue
<template>
  <div class="product-editor">
    <div class="editor-toolbar">
      <el-button @click="toggleEditMode">
        {{ editMode ? '退出编辑' : '开启编辑' }}
      </el-button>
      <el-button @click="saveChanges" type="primary">保存</el-button>
      <el-button @click="preview">预览</el-button>
    </div>
    
    <iframe 
      ref="editorFrame"
      :src="iframeSrc"
      class="editor-frame"
      @load="onFrameLoad"
    ></iframe>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'

const editMode = ref(false)
const editorFrame = ref(null)

const onFrameLoad = () => {
  // 注入编辑器脚本
  const frame = editorFrame.value
  const doc = frame.contentDocument
  
  // 加载编辑器
  const script1 = doc.createElement('script')
  script1.src = '/editor/auto-editable.js'
  doc.body.appendChild(script1)
  
  const script2 = doc.createElement('script')
  script2.src = '/editor/visual-editor.js'
  doc.body.appendChild(script2)
}

const toggleEditMode = () => {
  const frame = editorFrame.value
  const editor = frame.contentWindow.visualEditor
  if (editor) {
    editor.toggleEditMode()
    editMode.value = editor.editMode
  }
}

const saveChanges = async () => {
  const frame = editorFrame.value
  const editor = frame.contentWindow.visualEditor
  if (editor) {
    const changes = editor.changes
    // 调用 API 保存
    await saveProductConfig(changes)
  }
}
</script>
```

---

### Step 4: 路由配置

**文件**: `admin/src/router/index.js`

```javascript
{
  path: '/products',
  component: Layout,
  meta: { title: '产品管理', icon: 'box' },
  children: [
    {
      path: 'list',
      name: 'ProductList',
      component: () => import('@/views/products/list.vue'),
      meta: { title: '产品列表' }
    },
    {
      path: 'create',
      name: 'ProductCreate',
      component: () => import('@/views/products/edit.vue'),
      meta: { title: '创建产品' }
    },
    {
      path: 'edit/:id',
      name: 'ProductEdit',
      component: () => import('@/views/products/edit.vue'),
      meta: { title: '编辑产品' }
    },
    {
      path: 'categories',
      name: 'ProductCategories',
      component: () => import('@/views/products/categories.vue'),
      meta: { title: '分类管理' }
    }
  ]
}
```

---

## 📊 数据流程

### 创建产品流程
```
1. 用户填写基本信息
   ↓
2. 选择产品模板（或从现有产品复制）
   ↓
3. 进入可视化编辑器
   ↓
4. 双击编辑文字、上传图片
   ↓
5. 保存配置到数据库
   ↓
6. 生成产品详情页面文件
```

### 编辑产品流程
```
1. 从列表选择产品
   ↓
2. 加载产品详情页面到 iframe
   ↓
3. 加载已保存的配置
   ↓
4. 应用配置到页面
   ↓
5. 开启编辑模式
   ↓
6. 修改内容
   ↓
7. 保存新配置
```

---

## 🎯 优先级

### P0 - 核心功能（本周）
- [x] 可视化编辑器完成
- [ ] 产品列表页面
- [ ] 产品创建/编辑页面
- [ ] 基础 API 接口
- [ ] 数据库表创建

### P1 - 重要功能（下周）
- [ ] 分类管理
- [ ] 图片上传优化
- [ ] 配置保存/加载
- [ ] 预览功能

### P2 - 增强功能（后续）
- [ ] 批量操作
- [ ] 版本历史
- [ ] 模板管理
- [ ] SEO 优化

---

## 🛠️ 技术栈

### 后端
- Node.js + Express
- MySQL (数据存储)
- Multer (文件上传)

### 前端管理系统
- Vue 3 + Vite
- Element Plus (UI 组件)
- Pinia (状态管理)

### 可视化编辑器
- 原生 JavaScript
- LocalStorage (临时存储)
- JSON (配置格式)

---

## 📝 下一步行动

### 立即开始
1. ✅ 启动后端服务 (http://localhost:3001)
2. ✅ 启动管理系统 (http://localhost:3006)
3. ⏳ 创建数据库表
4. ⏳ 创建产品管理 API
5. ⏳ 创建产品列表页面

### 今天的目标
- 完成数据库设计和创建
- 完成基础 API 接口
- 创建产品列表页面框架

---

## 🎉 预期效果

### 管理员视角
```
1. 登录管理系统
2. 进入"产品管理" → "产品列表"
3. 点击"创建产品"
4. 填写基本信息
5. 进入可视化编辑器
6. 双击编辑文字、上传图片
7. 按 Ctrl+Z 撤销、Ctrl+Shift+Z 重做
8. 点击"保存"
9. 产品创建完成！
```

### 用户视角
```
1. 访问网站产品中心
2. 看到所有产品卡片
3. 点击产品查看详情
4. 看到精美的产品详情页面
5. 所有内容都是管理员通过可视化编辑器编辑的
```

---

## 🚀 开始实施

**当前状态**:
- ✅ 后端服务运行中: http://localhost:3001
- ✅ 管理系统运行中: http://localhost:3006
- ✅ 可视化编辑器已完成

**下一步**: 创建数据库表和 API 接口

准备好了吗？让我们开始吧！🎊
