# 后台管理系统完善计划

## 📊 项目概述

**项目名称**: 容电厨电后台管理系统  
**当前版本**: v1.0 (基础版)  
**目标版本**: v2.0 (完整版)  
**开发周期**: 3-4周  
**最后更新**: 2025-11-19

---

## 🎯 总体目标

将当前的后台管理系统从基础版升级到完整版,实现:
1. ✅ 完整的用户认证和权限系统
2. ✅ 功能完善的产品管理模块
3. ✅ 数据统计和可视化面板
4. ✅ 内容管理系统(CMS)
5. ✅ 系统配置和日志管理

---

## 📋 当前问题清单

### 🔴 严重问题 (必须立即解决)

1. **硬编码的登录账号**
   - 位置: `backend/src/controllers/authController.js`
   - 问题: 账号密码硬编码,无法管理多用户
   - 影响: 安全性差,无法扩展

2. **Mock数据代替真实数据**
   - 位置: `admin/src/mock/temp/formData.ts`
   - 问题: 用户列表、角色列表使用假数据
   - 影响: 无法进行真实的用户管理

3. **缺少数据库用户表**
   - 问题: 没有users表,无法存储用户信息
   - 影响: 无法实现用户管理功能

### 🟡 重要问题 (需要尽快解决)

4. **产品管理功能不完整**
   - 缺少图片上传功能
   - 缺少批量操作API
   - 缺少搜索和筛选

5. **订阅管理功能简陋**
   - 缺少数据导出
   - 缺少统计分析
   - 缺少邮件群发

6. **没有数据统计面板**
   - 缺少访问统计
   - 缺少销售数据
   - 缺少可视化图表

### 🟢 次要问题 (可以延后)

7. **缺少内容管理功能**
   - 新闻资讯管理
   - 轮播图管理
   - 公司介绍编辑

8. **缺少系统设置**
   - 网站配置
   - SEO设置
   - 日志管理

---

## 🗓️ 开发计划 (完整版 - 4周)

### 第一周: 用户认证系统 (A模块)

#### Day 1: 数据库设计和创建
**目标**: 创建用户相关数据表

**任务清单**:
- [x] 设计users表结构
- [ ] 设计roles表结构
- [ ] 设计permissions表结构
- [ ] 设计user_roles关联表
- [ ] 创建数据库迁移文件
- [ ] 执行数据库迁移
- [ ] 添加测试数据

**数据表设计**:
```sql
-- 用户表
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  username VARCHAR(50) UNIQUE NOT NULL,
  password VARCHAR(255) NOT NULL,
  nickname VARCHAR(50),
  email VARCHAR(100) UNIQUE,
  mobile VARCHAR(20),
  avatar VARCHAR(255),
  department VARCHAR(50),
  status VARCHAR(20) DEFAULT 'active',
  last_login_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 角色表
CREATE TABLE roles (
  id SERIAL PRIMARY KEY,
  role_code VARCHAR(50) UNIQUE NOT NULL,
  role_name VARCHAR(50) NOT NULL,
  description TEXT,
  status VARCHAR(20) DEFAULT 'active',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 权限表
CREATE TABLE permissions (
  id SERIAL PRIMARY KEY,
  permission_code VARCHAR(50) UNIQUE NOT NULL,
  permission_name VARCHAR(50) NOT NULL,
  resource VARCHAR(100),
  action VARCHAR(50),
  description TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 用户角色关联表
CREATE TABLE user_roles (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
  role_id INTEGER REFERENCES roles(id) ON DELETE CASCADE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UNIQUE(user_id, role_id)
);

-- 角色权限关联表
CREATE TABLE role_permissions (
  id SERIAL PRIMARY KEY,
  role_id INTEGER REFERENCES roles(id) ON DELETE CASCADE,
  permission_id INTEGER REFERENCES permissions(id) ON DELETE CASCADE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UNIQUE(role_id, permission_id)
);
```

**预计时间**: 4小时

---

#### Day 2: 用户注册和登录API
**目标**: 实现完整的用户认证功能

**任务清单**:
- [ ] 安装bcrypt加密库
- [ ] 创建User模型(Sequelize)
- [ ] 实现用户注册API
- [ ] 实现密码加密
- [ ] 修改登录API连接数据库
- [ ] 实现密码验证
- [ ] 优化JWT token生成
- [ ] 添加refresh token机制

**API接口**:
```javascript
POST /api/auth/register    // 用户注册
POST /api/auth/login       // 用户登录
POST /api/auth/logout      // 用户登出
POST /api/auth/refresh     // 刷新token
GET  /api/auth/profile     // 获取当前用户信息
PUT  /api/auth/profile     // 更新当前用户信息
PUT  /api/auth/password    // 修改密码
```

**预计时间**: 6小时

---

#### Day 3: 用户管理CRUD
**目标**: 实现用户管理的增删改查

**任务清单**:
- [ ] 实现用户列表查询API
- [ ] 实现用户详情查询API
- [ ] 实现用户创建API
- [ ] 实现用户更新API
- [ ] 实现用户删除API
- [ ] 实现用户状态切换API
- [ ] 添加搜索和筛选功能
- [ ] 添加分页功能

**API接口**:
```javascript
GET    /api/users          // 获取用户列表(分页、搜索、筛选)
GET    /api/users/:id      // 获取用户详情
POST   /api/users          // 创建用户
PUT    /api/users/:id      // 更新用户
DELETE /api/users/:id      // 删除用户
PATCH  /api/users/:id/status  // 切换用户状态
```

**预计时间**: 6小时

---

#### Day 4: 角色权限系统
**目标**: 实现RBAC权限控制

**任务清单**:
- [ ] 创建Role和Permission模型
- [ ] 实现角色管理CRUD API
- [ ] 实现权限管理CRUD API
- [ ] 实现角色权限分配
- [ ] 实现用户角色分配
- [ ] 创建权限验证中间件
- [ ] 在路由中应用权限控制

**API接口**:
```javascript
// 角色管理
GET    /api/roles          // 获取角色列表
POST   /api/roles          // 创建角色
PUT    /api/roles/:id      // 更新角色
DELETE /api/roles/:id      // 删除角色
POST   /api/roles/:id/permissions  // 分配权限

// 权限管理
GET    /api/permissions    // 获取权限列表
POST   /api/permissions    // 创建权限
```

**预计时间**: 8小时

---

#### Day 5: 前端用户管理页面
**目标**: 替换Mock数据,连接真实API

**任务清单**:
- [ ] 修改用户列表页面连接API
- [ ] 实现用户添加对话框
- [ ] 实现用户编辑对话框
- [ ] 实现用户删除确认
- [ ] 实现搜索和筛选功能
- [ ] 实现分页功能
- [ ] 优化表格展示
- [ ] 添加加载状态

**文件修改**:
- `admin/src/views/system/user/index.vue`
- `admin/src/views/system/user/modules/user-dialog.vue`
- `admin/src/api/usersApi.ts`

**预计时间**: 6小时

---

#### Day 6-7: 前端角色权限管理
**目标**: 实现角色和权限管理界面

**任务清单**:
- [ ] 修改角色列表页面连接API
- [ ] 实现角色添加/编辑对话框
- [ ] 实现权限分配功能
- [ ] 实现权限树形选择器
- [ ] 实现用户角色分配
- [ ] 添加权限验证指令
- [ ] 在菜单中应用权限控制
- [ ] 测试权限系统

**文件修改**:
- `admin/src/views/system/role/index.vue`
- `admin/src/views/system/menu/index.vue`
- `admin/src/directives/roles.ts`

**预计时间**: 12小时

---

### 第二周: 产品管理完善 (B模块)

#### Day 1: 图片上传功能
**目标**: 实现产品图片上传和管理

**任务清单**:
- [ ] 安装multer文件上传中间件
- [ ] 创建uploads目录
- [ ] 实现图片上传API
- [ ] 实现图片压缩和裁剪
- [ ] 实现图片删除API
- [ ] 前端集成图片上传组件
- [ ] 实现图片预览功能
- [ ] 实现多图上传

**API接口**:
```javascript
POST   /api/upload/image       // 上传单张图片
POST   /api/upload/images      // 上传多张图片
DELETE /api/upload/image/:id   // 删除图片
```

**预计时间**: 6小时

---

#### Day 2: 产品批量操作
**目标**: 实现产品的批量管理功能

**任务清单**:
- [ ] 实现批量删除API
- [ ] 实现批量上架API
- [ ] 实现批量下架API
- [ ] 实现批量修改分类API
- [ ] 实现批量修改标签API
- [ ] 前端实现批量选择
- [ ] 前端实现批量操作按钮
- [ ] 添加操作确认提示

**API接口**:
```javascript
POST /api/products/batch-delete     // 批量删除
POST /api/products/batch-publish    // 批量上架
POST /api/products/batch-unpublish  // 批量下架
POST /api/products/batch-category   // 批量修改分类
```

**预计时间**: 6小时

---

#### Day 3: 产品搜索和筛选
**目标**: 完善产品查询功能

**任务清单**:
- [ ] 实现关键词搜索
- [ ] 实现分类筛选
- [ ] 实现标签筛选
- [ ] 实现价格区间筛选
- [ ] 实现状态筛选
- [ ] 实现排序功能
- [ ] 优化查询性能
- [ ] 添加搜索历史

**查询参数**:
```javascript
GET /api/products?
  keyword=抽油烟机&
  category=1&
  tag=热销&
  minPrice=1000&
  maxPrice=5000&
  status=active&
  sortBy=sales&
  order=desc&
  page=1&
  size=20
```

**预计时间**: 6小时

---

#### Day 4: 产品分类和标签管理
**目标**: 完善分类和标签功能

**任务清单**:
- [ ] 优化分类树形结构
- [ ] 实现分类拖拽排序
- [ ] 实现分类图标上传
- [ ] 完善标签管理
- [ ] 实现标签颜色设置
- [ ] 前端分类选择器优化
- [ ] 前端标签选择器优化

**预计时间**: 6小时

---

#### Day 5: 产品详情页优化
**目标**: 完善产品详情展示

**任务清单**:
- [ ] 实现产品规格参数管理
- [ ] 实现产品详情富文本编辑
- [ ] 实现产品图片轮播
- [ ] 实现相关产品推荐
- [ ] 优化产品详情页面布局
- [ ] 添加产品浏览统计

**预计时间**: 6小时

---

### 第三周: 数据统计面板 (C模块)

#### Day 1-2: 统计数据API
**目标**: 实现各类统计数据接口

**任务清单**:
- [ ] 实现总览统计API(用户、产品、订阅数)
- [ ] 实现访问统计API
- [ ] 实现产品浏览统计API
- [ ] 实现订阅转化率API
- [ ] 实现销售统计API
- [ ] 实现热门产品排行API
- [ ] 实现用户增长趋势API
- [ ] 优化统计查询性能

**API接口**:
```javascript
GET /api/stats/overview        // 总览统计
GET /api/stats/visits          // 访问统计
GET /api/stats/products        // 产品统计
GET /api/stats/subscriptions   // 订阅统计
GET /api/stats/sales           // 销售统计
GET /api/stats/trending        // 趋势分析
```

**预计时间**: 12小时

---

#### Day 3-4: 数据可视化
**目标**: 实现数据图表展示

**任务清单**:
- [ ] 安装ECharts图表库
- [ ] 创建统计卡片组件
- [ ] 实现折线图(访问趋势)
- [ ] 实现柱状图(产品销量)
- [ ] 实现饼图(分类占比)
- [ ] 实现排行榜组件
- [ ] 实现数据刷新功能
- [ ] 优化图表响应式

**图表类型**:
- 总览卡片: 用户数、产品数、订阅数、访问量
- 折线图: 访问趋势、订阅趋势
- 柱状图: 产品销量、分类销量
- 饼图: 产品分类占比、订阅渠道占比
- 排行榜: 热门产品、热门分类

**预计时间**: 12小时

---

#### Day 5: 订阅管理完善
**目标**: 完善订阅管理功能

**任务清单**:
- [ ] 实现订阅数据导出(Excel)
- [ ] 实现订阅统计图表
- [ ] 实现订阅来源分析
- [ ] 实现邮件群发功能
- [ ] 添加订阅标签管理
- [ ] 优化订阅列表展示

**预计时间**: 6小时

---

### 第四周: 内容管理和系统设置 (D模块)

#### Day 1-2: 内容管理系统
**目标**: 实现CMS功能

**任务清单**:
- [ ] 创建articles表(新闻资讯)
- [ ] 创建banners表(轮播图)
- [ ] 创建pages表(页面内容)
- [ ] 实现新闻管理CRUD
- [ ] 实现轮播图管理CRUD
- [ ] 实现页面内容编辑
- [ ] 集成富文本编辑器(WangEditor)
- [ ] 实现内容发布/下架

**数据表设计**:
```sql
-- 新闻资讯表
CREATE TABLE articles (
  id SERIAL PRIMARY KEY,
  title VARCHAR(200) NOT NULL,
  summary TEXT,
  content TEXT,
  cover_image VARCHAR(255),
  author VARCHAR(50),
  category VARCHAR(50),
  tags VARCHAR(255),
  views INTEGER DEFAULT 0,
  status VARCHAR(20) DEFAULT 'draft',
  published_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 轮播图表
CREATE TABLE banners (
  id SERIAL PRIMARY KEY,
  title VARCHAR(100),
  image VARCHAR(255) NOT NULL,
  link VARCHAR(255),
  sort_order INTEGER DEFAULT 0,
  status VARCHAR(20) DEFAULT 'active',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 页面内容表
CREATE TABLE pages (
  id SERIAL PRIMARY KEY,
  page_key VARCHAR(50) UNIQUE NOT NULL,
  title VARCHAR(100),
  content TEXT,
  meta_title VARCHAR(200),
  meta_description TEXT,
  meta_keywords VARCHAR(255),
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**预计时间**: 12小时

---

#### Day 3: 系统设置
**目标**: 实现系统配置功能

**任务清单**:
- [ ] 创建settings表
- [ ] 实现网站基本信息设置
- [ ] 实现SEO设置
- [ ] 实现邮件服务器配置
- [ ] 实现上传配置
- [ ] 实现系统参数管理
- [ ] 前端设置页面开发

**配置项**:
- 网站名称、Logo、描述
- SEO关键词、描述
- SMTP邮件配置
- 文件上传限制
- 系统维护模式

**预计时间**: 6小时

---

#### Day 4: 操作日志
**目标**: 实现操作日志记录

**任务清单**:
- [ ] 创建operation_logs表
- [ ] 实现日志记录中间件
- [ ] 记录用户操作日志
- [ ] 实现日志查询API
- [ ] 实现日志筛选功能
- [ ] 前端日志查看页面
- [ ] 实现日志导出

**日志内容**:
- 操作用户
- 操作类型(增删改查)
- 操作模块
- 操作详情
- IP地址
- 操作时间

**预计时间**: 6小时

---

#### Day 5: 测试和优化
**目标**: 全面测试和性能优化

**任务清单**:
- [ ] 功能测试(所有模块)
- [ ] 权限测试
- [ ] 性能测试
- [ ] 安全测试
- [ ] Bug修复
- [ ] 代码优化
- [ ] 文档完善
- [ ] 部署准备

**预计时间**: 6小时

---

## 📊 进度跟踪

### 第一周进度
- [x] Day 1: 数据库设计 (100%)
- [x] Day 2: 用户认证API (100%)
- [x] Day 3: 用户管理CRUD (100%)
- [x] Day 4: 角色权限系统 (100%)
- [x] Day 5: 前端用户管理 (100%)
- [ ] Day 6-7: 前端角色权限 (0%)

### 第二周进度
- [ ] Day 1: 图片上传 (0%)
- [ ] Day 2: 批量操作 (0%)
- [ ] Day 3: 搜索筛选 (0%)
- [ ] Day 4: 分类标签 (0%)
- [ ] Day 5: 产品详情 (0%)

### 第三周进度
- [ ] Day 1-2: 统计API (0%)
- [ ] Day 3-4: 数据可视化 (0%)
- [ ] Day 5: 订阅管理 (0%)

### 第四周进度
- [ ] Day 1-2: 内容管理 (0%)
- [ ] Day 3: 系统设置 (0%)
- [ ] Day 4: 操作日志 (0%)
- [ ] Day 5: 测试优化 (0%)

---

## 🛠️ 技术栈

### 后端
- Node.js + Express
- PostgreSQL + Sequelize ORM
- JWT认证
- Bcrypt密码加密
- Multer文件上传
- Nodemailer邮件发送

### 前端
- Vue 3 + TypeScript
- Element Plus UI
- Pinia状态管理
- Axios HTTP客户端
- ECharts图表库
- WangEditor富文本编辑器

### 开发工具
- Git版本控制
- ESLint代码检查
- Prettier代码格式化
- Vite构建工具

---

## 📝 开发规范

### Git提交规范
```bash
feat: 新功能
fix: Bug修复
docs: 文档更新
style: 代码格式调整
refactor: 代码重构
test: 测试相关
chore: 构建/工具相关
```

### 代码规范
- 使用ESLint + Prettier
- 遵循Airbnb JavaScript规范
- 组件命名使用PascalCase
- 函数命名使用camelCase
- 常量命名使用UPPER_SNAKE_CASE

### API规范
- RESTful API设计
- 统一响应格式
- 统一错误处理
- API版本控制

---

## 🎯 验收标准

### 功能完整性
- [ ] 所有计划功能已实现
- [ ] 所有API接口正常工作
- [ ] 所有页面功能正常
- [ ] 无严重Bug

### 性能要求
- [ ] 页面加载时间 < 2秒
- [ ] API响应时间 < 500ms
- [ ] 支持1000+并发用户

### 安全要求
- [ ] 密码加密存储
- [ ] JWT token验证
- [ ] RBAC权限控制
- [ ] SQL注入防护
- [ ] XSS防护
- [ ] CSRF防护

### 代码质量
- [ ] 代码覆盖率 > 80%
- [ ] 无ESLint错误
- [ ] 代码注释完整
- [ ] API文档完整

---

## 📚 参考文档

- [项目开发计划](./项目开发计划.md)
- [前端后端集成指南](./前端后端集成指南.md)
- [后端实现指南](./后端实现指南.md)
- [管理后台登录说明](./管理后台登录说明.md)

---

## 🚀 开始开发

### 准备工作
1. 确保开发环境已配置
2. 确保数据库已启动
3. 确保后端服务已启动
4. 确保前端服务已启动

### 开发流程
1. 创建功能分支
2. 开发功能
3. 本地测试
4. 提交代码
5. 合并到develop分支
6. 部署测试环境

---

**开发开始时间**: 2025-11-19  
**预计完成时间**: 2025-12-17  
**当前状态**: 准备开始 🚀
