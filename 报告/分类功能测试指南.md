# 分类功能测试指南

## 测试目标
验证分类创建、更新和前后端同步功能是否正常工作。

## 前置条件

### 1. 启动后端服务
```bash
cd backend
npm start
```
确认服务运行在 `http://localhost:3000`

### 2. 启动前端管理系统
```bash
cd admin
npm run dev
```

### 3. 准备前端网站
确保前端网站的HTML文件已引入 `category-loader.js`

## 测试步骤

### 测试1: 后台创建分类

#### 步骤
1. 打开后台管理系统 `http://localhost:5173`（或你的端口）
2. 登录系统
3. 进入"产品管理"页面
4. 点击左侧分类列表上方的"新增分类"按钮
5. 填写分类信息：
   - 分类名称：`测试分类A`
   - 父分类：留空（创建顶级分类）
   - 图标：选择任意图标
   - 描述：`这是一个测试分类`
   - 排序权重：`10`
   - 状态：`启用`
6. 点击"创建"按钮

#### 预期结果
- ✅ 显示"分类创建成功"提示
- ✅ 显示"分类列表已更新"提示
- ✅ 左侧分类列表自动刷新，显示新创建的分类
- ✅ 新分类出现在列表中，显示正确的名称和图标

#### 调试方法
如果失败，打开浏览器控制台（F12）查看：
1. Console 标签中的错误信息
2. Network 标签中的 API 请求：
   - `POST /api/product-categories` - 创建请求
   - `GET /api/product-categories` - 刷新请求

---

### 测试2: 创建子分类

#### 步骤
1. 在左侧分类列表中找到刚创建的"测试分类A"
2. 点击"新增分类"按钮
3. 填写分类信息：
   - 分类名称：`测试子分类B`
   - 父分类：选择"测试分类A"
   - 其他字段按需填写
4. 点击"创建"按钮

#### 预期结果
- ✅ 显示创建成功提示
- ✅ "测试分类A"自动展开
- ✅ "测试子分类B"出现在"测试分类A"下方
- ✅ 父分类的产品数量更新

---

### 测试3: 验证后端API

#### 步骤
1. 打开浏览器新标签页
2. 访问 `http://localhost:3000/api/product-categories`
3. 查看返回的JSON数据

#### 预期结果
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "测试分类A",
      "parentId": null,
      "icon": "Coffee",
      "description": "这是一个测试分类",
      "sortOrder": 10,
      "status": "active",
      "productCount": 0,
      "children": [
        {
          "id": 2,
          "name": "测试子分类B",
          "parentId": 1,
          "icon": null,
          "description": "",
          "sortOrder": 0,
          "status": "active",
          "productCount": 0
        }
      ]
    }
  ]
}
```

---

### 测试4: 前端网站同步

#### 步骤
1. 打开前端网站（例如：`http://localhost:8080` 或直接打开HTML文件）
2. 找到产品分类筛选区域
3. 观察分类列表

#### 预期结果
- ✅ 页面加载时自动显示"测试分类A"
- ✅ 展开"测试分类A"后显示"测试子分类B"
- ✅ 分类旁边显示产品数量（可能为0）
- ✅ 页面上有"刷新分类"按钮

#### 调试方法
打开浏览器控制台查看：
```
初始化分类加载器...
从API加载分类数据...
分类数据加载成功: [...]
已渲染 X 个分类
```

---

### 测试5: 手动刷新同步

#### 步骤
1. 在后台管理系统创建新分类"测试分类C"
2. 切换到前端网站标签页
3. 点击"刷新分类"按钮
4. 观察分类列表

#### 预期结果
- ✅ 按钮显示"⏳ 刷新中..."
- ✅ 1-2秒后显示"✓ 刷新成功"
- ✅ 分类列表更新，显示"测试分类C"
- ✅ 按钮恢复为"🔄 刷新分类"

---

### 测试6: 分类选择功能

#### 步骤
1. 在前端网站的分类列表中
2. 勾选"测试分类A"的复选框
3. 观察控制台输出

#### 预期结果
- ✅ 控制台显示：`分类 1 已选中`
- ✅ 如果有子分类，子分类的复选框也被自动选中
- ✅ 控制台显示：`选中的分类: [1]`

---

### 测试7: 编辑分类

#### 步骤
1. 在后台管理系统中
2. 点击"测试分类A"旁边的编辑按钮
3. 修改分类名称为"测试分类A-已修改"
4. 点击"更新"按钮

#### 预期结果
- ✅ 显示"分类更新成功"提示
- ✅ 分类列表自动刷新
- ✅ 分类名称更新为"测试分类A-已修改"

---

### 测试8: 删除分类

#### 步骤
1. 在后台管理系统中
2. 点击"测试子分类B"旁边的删除按钮
3. 确认删除

#### 预期结果
- ✅ 显示确认对话框
- ✅ 确认后显示"分类删除成功"
- ✅ 分类列表自动刷新
- ✅ "测试子分类B"从列表中消失

---

## 性能测试

### 测试9: 缓存机制

#### 步骤
1. 打开前端网站
2. 打开浏览器控制台
3. 观察首次加载的日志
4. 刷新页面（F5）
5. 观察第二次加载的日志

#### 预期结果
- 首次加载：`从API加载分类数据...`
- 5分钟内刷新：`使用缓存的分类数据`
- 5分钟后刷新：`从API加载分类数据...`

---

### 测试10: 多分类创建

#### 步骤
1. 连续创建5个分类
2. 观察每次创建后的刷新速度

#### 预期结果
- ✅ 每次创建后列表快速刷新（< 1秒）
- ✅ 不会出现卡顿或延迟
- ✅ 所有分类按 sortOrder 正确排序

---

## 故障排查

### 问题1: 创建成功但列表不更新

**检查项**:
1. 浏览器控制台是否有错误
2. Network 标签中 GET 请求是否成功
3. 返回的数据格式是否正确

**解决方法**:
```javascript
// 在控制台手动测试
const response = await fetch('http://localhost:3000/api/product-categories?includeProducts=true');
const data = await response.json();
console.log(data);
```

---

### 问题2: 前端网站不显示分类

**检查项**:
1. HTML中是否引入了 `category-loader.js`
2. HTML中是否有 `.filter-category-list` 容器
3. API地址配置是否正确
4. 是否有跨域错误

**解决方法**:
```javascript
// 在控制台测试
window.CategoryLoader.loadCategories(true).then(console.log);
```

---

### 问题3: 跨域错误

**错误信息**:
```
Access to fetch at 'http://localhost:3000/api/product-categories' 
from origin 'http://localhost:8080' has been blocked by CORS policy
```

**解决方法**:
后端已配置CORS，确认 `backend/src/app.js` 中有：
```javascript
app.use(cors({
  origin: '*',
  credentials: true
}));
```

---

## 测试清单

完成以下所有测试项：

- [ ] 测试1: 后台创建分类
- [ ] 测试2: 创建子分类
- [ ] 测试3: 验证后端API
- [ ] 测试4: 前端网站同步
- [ ] 测试5: 手动刷新同步
- [ ] 测试6: 分类选择功能
- [ ] 测试7: 编辑分类
- [ ] 测试8: 删除分类
- [ ] 测试9: 缓存机制
- [ ] 测试10: 多分类创建

---

## 测试报告模板

```
测试日期: ____________________
测试人员: ____________________

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 后台创建分类 | ✅/❌ | |
| 创建子分类 | ✅/❌ | |
| 后端API验证 | ✅/❌ | |
| 前端网站同步 | ✅/❌ | |
| 手动刷新 | ✅/❌ | |
| 分类选择 | ✅/❌ | |
| 编辑分类 | ✅/❌ | |
| 删除分类 | ✅/❌ | |
| 缓存机制 | ✅/❌ | |
| 多分类创建 | ✅/❌ | |

总体评价: ____________________
发现的问题: ____________________
建议改进: ____________________
```

---

## 下一步

测试通过后，可以：
1. 清理测试数据（删除测试分类）
2. 创建实际的产品分类
3. 为分类添加产品
4. 测试产品筛选功能

---

**祝测试顺利！** 🎉
