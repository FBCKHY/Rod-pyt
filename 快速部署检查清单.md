# âœ… å¿«é€Ÿéƒ¨ç½²æ£€æŸ¥æ¸…å•

## ğŸ“‹ éƒ¨ç½²å‰å‡†å¤‡

### 1. æœ¬åœ°å‡†å¤‡
- [ ] æ‰€æœ‰ä»£ç å·²æµ‹è¯•é€šè¿‡
- [ ] å‰ç«¯å·²æ„å»ºç”Ÿäº§ç‰ˆæœ¬ (`cd admin && pnpm build`)
- [ ] æ•°æ®åº“ç»“æ„å·²ç¡®è®¤
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] åŸŸåå·²å¤‡æ¡ˆ(ä¸­å›½å¤§é™†)

### 2. é˜¿é‡Œäº‘å‡†å¤‡
- [ ] å·²è´­ä¹°ECSæœåŠ¡å™¨(æ¨è: 2æ ¸4G)
- [ ] å·²è´­ä¹°åŸŸå
- [ ] åŸŸåå·²è§£æåˆ°æœåŠ¡å™¨IP
- [ ] å®‰å…¨ç»„å·²é…ç½®(å¼€æ”¾80, 443, 22ç«¯å£)
- [ ] å·²ç”³è¯·SSLè¯ä¹¦(å¯é€‰)

---

## ğŸ–¥ï¸ æœåŠ¡å™¨é…ç½®

### 1. è¿æ¥æœåŠ¡å™¨
```bash
ssh root@your-server-ip
```

### 2. å®‰è£…åŸºç¡€ç¯å¢ƒ
```bash
# æ›´æ–°ç³»ç»Ÿ
apt update && apt upgrade -y

# å®‰è£…Node.js 18
curl -fsSL https://deb.nodesource.com/setup_18.x | bash -
apt install -y nodejs

# å®‰è£…pnpm
npm install -g pnpm

# å®‰è£…PostgreSQL
apt install -y postgresql postgresql-contrib

# å®‰è£…Nginx
apt install -y nginx

# å®‰è£…PM2
npm install -g pm2

# å®‰è£…Git
apt install -y git
```

### 3. éªŒè¯å®‰è£…
```bash
node --version  # v18.x.x
pnpm --version
psql --version
nginx -v
pm2 --version
```

---

## ğŸ—„ï¸ æ•°æ®åº“é…ç½®

### 1. åˆ›å»ºæ•°æ®åº“
```bash
sudo -u postgres psql
```

```sql
CREATE USER rongdian WITH PASSWORD 'your_secure_password';
CREATE DATABASE rongdian_db OWNER rongdian;
GRANT ALL PRIVILEGES ON DATABASE rongdian_db TO rongdian;
\q
```

### 2. æµ‹è¯•è¿æ¥
```bash
psql -h localhost -U rongdian -d rongdian_db
# è¾“å…¥å¯†ç ,èƒ½è¿æ¥å³æˆåŠŸ
\q
```

---

## ğŸ“ ä¸Šä¼ æ–‡ä»¶

### æ–¹å¼1: ä½¿ç”¨SCP(æ¨è)
```bash
# åœ¨æœ¬åœ°PowerShellæ‰§è¡Œ
scp -r "c:\Users\13350\Desktop\oai 08\backend" root@your-server-ip:/var/www/rongdian/
scp -r "c:\Users\13350\Desktop\oai 08\web Site" root@your-server-ip:/var/www/rongdian/
scp -r "c:\Users\13350\Desktop\oai 08\admin\dist" root@your-server-ip:/var/www/rongdian/admin-dist
```

### æ–¹å¼2: ä½¿ç”¨Git
```bash
# åœ¨æœåŠ¡å™¨æ‰§è¡Œ
cd /var/www
git clone https://your-repo-url.git rongdian
```

---

## âš™ï¸ é…ç½®åç«¯

### 1. åˆ›å»ºç¯å¢ƒå˜é‡
```bash
cd /var/www/rongdian/backend
nano .env
```

å¤åˆ¶ä»¥ä¸‹å†…å®¹å¹¶ä¿®æ”¹:
```env
NODE_ENV=production
PORT=3001
HOST=0.0.0.0

DB_HOST=localhost
DB_PORT=5432
DB_NAME=rongdian_db
DB_USER=rongdian
DB_PASSWORD=your_secure_password

JWT_SECRET=your_jwt_secret_min_32_chars
JWT_EXPIRES_IN=7d

RATE_LIMIT_ENABLED=true
LOG_LEVEL=info
CORS_ORIGIN=https://your-domain.com
```

### 2. å®‰è£…ä¾èµ–
```bash
cd /var/www/rongdian/backend
pnpm install --prod
```

### 3. è¿è¡Œè¿ç§»
```bash
pnpm db:push
# æˆ–
pnpm db:migrate
```

### 4. æµ‹è¯•å¯åŠ¨
```bash
NODE_ENV=production node src/app.js
# çœ‹åˆ° "ğŸš€ æœåŠ¡å™¨è¿è¡Œåœ¨..." å³æˆåŠŸ
# Ctrl+C åœæ­¢
```

---

## ğŸŒ é…ç½®Nginx

### 1. åˆ›å»ºé…ç½®æ–‡ä»¶
```bash
nano /etc/nginx/sites-available/rongdian
```

ç²˜è´´ä»¥ä¸‹å†…å®¹(ä¿®æ”¹åŸŸå):
```nginx
upstream backend_api {
    server 127.0.0.1:3001;
}

server {
    listen 80;
    server_name your-domain.com www.your-domain.com;

    client_max_body_size 20M;

    # åå°ç®¡ç†
    location /admin {
        alias /var/www/rongdian/admin-dist;
        try_files $uri $uri/ /admin/index.html;
    }

    # API
    location /api {
        proxy_pass http://backend_api;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # äº§å“æ–‡ä»¶
    location /products {
        alias /var/www/rongdian/backend/public/products;
    }

    # ä¸Šä¼ æ–‡ä»¶
    location /uploads {
        alias /var/www/rongdian/backend/public/uploads;
    }

    # ç½‘ç«™å‰ç«¯
    location / {
        root /var/www/rongdian/web Site/web PC;
        try_files $uri $uri/ /index.html;
    }

    location /assets {
        alias /var/www/rongdian/web Site/web PC/assets;
    }
}
```

### 2. å¯ç”¨é…ç½®
```bash
ln -s /etc/nginx/sites-available/rongdian /etc/nginx/sites-enabled/
nginx -t
systemctl restart nginx
```

---

## ğŸ”„ é…ç½®PM2

### 1. å¯åŠ¨åº”ç”¨
```bash
cd /var/www/rongdian/backend
pm2 start ecosystem.config.js
```

### 2. è®¾ç½®å¼€æœºè‡ªå¯
```bash
pm2 startup
pm2 save
```

### 3. æŸ¥çœ‹çŠ¶æ€
```bash
pm2 status
pm2 logs
```

---

## ğŸ” é…ç½®SSL(å¯é€‰ä½†æ¨è)

### ä½¿ç”¨Let's Encryptå…è´¹è¯ä¹¦
```bash
# å®‰è£…Certbot
apt install -y certbot python3-certbot-nginx

# è·å–è¯ä¹¦
certbot --nginx -d your-domain.com -d www.your-domain.com

# æµ‹è¯•è‡ªåŠ¨ç»­æœŸ
certbot renew --dry-run
```

---

## ğŸ§ª æµ‹è¯•éƒ¨ç½²

### 1. æµ‹è¯•åç«¯API
```bash
curl http://localhost:3001/api/health
# åº”è¯¥è¿”å›: {"code":200,"msg":"Service is healthy",...}
```

### 2. æµ‹è¯•Nginx
```bash
curl http://localhost
# åº”è¯¥è¿”å›HTMLå†…å®¹
```

### 3. æµè§ˆå™¨æµ‹è¯•
- è®¿é—®: `http://your-domain.com` (ç½‘ç«™é¦–é¡µ)
- è®¿é—®: `http://your-domain.com/admin` (åå°ç®¡ç†)
- è®¿é—®: `http://your-domain.com/api/health` (APIå¥åº·æ£€æŸ¥)

---

## ğŸ” å¸¸è§é—®é¢˜

### 1. 502 Bad Gateway
```bash
# æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
pm2 status

# æŸ¥çœ‹åç«¯æ—¥å¿—
pm2 logs rongdian-backend

# é‡å¯åç«¯
pm2 restart rongdian-backend
```

### 2. é™æ€æ–‡ä»¶404
```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /var/www/rongdian/

# ä¿®æ”¹æƒé™
chown -R www-data:www-data /var/www/rongdian
chmod -R 755 /var/www/rongdian
```

### 3. æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥PostgreSQLçŠ¶æ€
systemctl status postgresql

# æµ‹è¯•è¿æ¥
psql -h localhost -U rongdian -d rongdian_db

# æŸ¥çœ‹åç«¯æ—¥å¿—
pm2 logs rongdian-backend --err
```

---

## ğŸ“Š ç›‘æ§å‘½ä»¤

```bash
# æŸ¥çœ‹PM2çŠ¶æ€
pm2 status

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
pm2 logs rongdian-backend

# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop

# æŸ¥çœ‹Nginxæ—¥å¿—
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# æŸ¥çœ‹ç«¯å£ç›‘å¬
netstat -tulpn | grep LISTEN
```

---

## ğŸ‰ éƒ¨ç½²å®Œæˆ!

### æœ€ç»ˆæ£€æŸ¥
- [ ] ç½‘ç«™å¯ä»¥è®¿é—®
- [ ] åå°ç®¡ç†å¯ä»¥ç™»å½•
- [ ] APIæ¥å£æ­£å¸¸
- [ ] äº§å“è¯¦æƒ…é¡µæ­£å¸¸
- [ ] æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- [ ] SSLè¯ä¹¦æ­£å¸¸(å¦‚æœé…ç½®)
- [ ] PM2è‡ªå¯åŠ¨å·²é…ç½®

### ä¸‹ä¸€æ­¥
1. é…ç½®åŸŸåå¤‡æ¡ˆ(ä¸­å›½å¤§é™†å¿…éœ€)
2. é…ç½®CDNåŠ é€Ÿ(å¯é€‰)
3. è®¾ç½®å®šæ—¶å¤‡ä»½
4. é…ç½®ç›‘æ§å‘Šè­¦
5. ä¼˜åŒ–æ€§èƒ½

---

**ğŸŠ æ­å–œ!ä½ çš„ç½‘ç«™å·²ç»æˆåŠŸéƒ¨ç½²åˆ°é˜¿é‡Œäº‘!** ğŸš€
